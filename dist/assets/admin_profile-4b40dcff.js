import"./input-ac4e21e1.js";import{u}from"./UserServices-9109671c.js";import{a as l}from"./AuthServices-0f733033.js";import{T as L}from"./toastify-3acd0462.js";/* empty css                 */document.addEventListener("DOMContentLoaded",()=>{feather.replace();const c=document.getElementById("adminProfilePhotoPreview"),p=document.getElementById("adminPhotoUpload"),f=document.getElementById("adminName"),g=document.getElementById("adminEmail"),y=document.getElementById("adminPosition"),h=document.getElementById("adminDepartment"),E=document.getElementById("adminAddress"),b=document.getElementById("adminProfileForm"),S=document.getElementById("adminCancelProfileEditBtn"),i=document.getElementById("adminBaseSalary"),B=document.getElementById("adminToggleSalaryVisibility"),v=document.getElementById("adminSalaryEyeIcon");let P="",s={};const n=(t,r="success")=>{let e;r==="success"?e="linear-gradient(to right, #22c55e, #16a34a)":r==="error"?e="linear-gradient(to right, #ef4444, #dc2626)":e="linear-gradient(to right, #3b82f6, #2563eb)",L({text:t,duration:3e3,close:!0,gravity:"top",position:"right",stopOnFocus:!0,style:{background:e,borderRadius:"8px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",padding:"12px 20px"}}).showToast()},I=async()=>{try{const t=localStorage.getItem("user");if(!t)throw new Error("Sesi tidak valid. Harap login kembali.");const r=JSON.parse(t);if(r.role!=="admin"){n("Akses ditolak. Halaman ini hanya untuk Admin.","error"),setTimeout(()=>l.logout(),1500);return}const e=await u.getUserByID(r.id);if(e){f.value=e.name||"",g.value=e.email||"",y.value=e.position||"",h.value=e.department||"",E.value=e.address||"",P=e.base_salary,i&&(i.value="••••••••••",i.dataset.masked="true",v.setAttribute("data-feather","eye"),feather.replace()),s={name:e.name||"",email:e.email||"",position:e.position||"",department:e.department||"",base_salary:e.base_salary||0,address:e.address||""};const o=document.getElementById("userAvatar");o&&(o.src=e.photo_url||"https://placehold.co/40x40/E2E8F0/4A5568?text=AD");try{const a=await u.getProfilePhoto(r.id),d=URL.createObjectURL(a);c.src=d}catch{c.src="https://placehold.co/128x128/E2E8F0/4A5568?text=AD"}}}catch(t){console.error("Error loading admin profile data:",t),n(t.message||"Gagal memuat data profil admin. Silakan coba lagi.","error"),(t.message.includes("Sesi")||t.status===401||t.status===403)&&setTimeout(()=>l.logout(),2e3)}},A=t=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(t);b&&b.addEventListener("submit",async t=>{t.preventDefault();const r=localStorage.getItem("user");try{if(!r)throw new Error("Sesi tidak valid. Harap login kembali.");const e=JSON.parse(r);if(e.role!=="admin"){n("Akses ditolak. Anda tidak diizinkan mengubah data ini.","error");return}const o=p.files[0],a={};f.value.trim()!==s.name&&(a.name=f.value.trim()),g.value.trim()!==s.email&&(a.email=g.value.trim()),y.value.trim()!==s.position&&(a.position=y.value.trim()),h.value.trim()!==s.department&&(a.department=h.value.trim());const d=parseFloat(i.value.replace(/[^0-9,-]+/g,"").replace(",","."));if(d!==s.base_salary&&!isNaN(d)&&(a.base_salary=d),E.value.trim()!==s.address&&(a.address=E.value.trim()),Object.keys(a).length===0&&!o)return n("Tidak ada perubahan untuk disimpan.","info");if(Object.keys(a).length>0){await u.updateUser(e.id,a);const m=l.getCurrentUser();m&&(a.email&&(m.email=a.email),a.name&&(m.name=a.name),localStorage.setItem("user",JSON.stringify(m)))}if(o){if(o.size>5*1024*1024){n("Ukuran file maksimal adalah 5MB.","error");return}const D=await u.uploadProfilePhoto(e.id,o),w=await u.getProfilePhoto(e.id);c.src=URL.createObjectURL(w);const k=l.getCurrentUser();k&&(k.photo_url=D.photo_url||`/api/users/${e.id}/photo`,localStorage.setItem("user",JSON.stringify(k)))}n("Profil admin berhasil diupdate!","success"),I()}catch(e){console.error("Error updating admin profile:",e);const o=e.response&&e.response.data&&e.response.data.error?e.response.data.error:e.message||"Gagal mengupdate profil admin.";n(o,"error"),(e.status===401||e.status===403)&&setTimeout(()=>l.logout(),2e3)}}),S&&S.addEventListener("click",t=>{t.preventDefault(),b.reset(),I(),n("Perubahan dibatalkan.","info")}),B&&B.addEventListener("click",()=>{i.dataset.masked==="true"?(i.value=A(P),i.dataset.masked="false",v.setAttribute("data-feather","eye-off")):(i.value="••••••••••",i.dataset.masked="true",v.setAttribute("data-feather","eye")),feather.replace()}),p&&p.addEventListener("change",function(){if(this.files&&this.files[0]){const t=new FileReader;t.onload=r=>{c.src=r.target.result},t.readAsDataURL(this.files[0])}}),document.querySelectorAll("#logoutButton, #dropdownLogoutButton, #mobileLogoutButton").forEach(t=>{t.addEventListener("click",r=>{r.preventDefault(),l.logout()})}),I()});
