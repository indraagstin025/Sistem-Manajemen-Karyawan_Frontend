import"./input-cba40e84.js";import{u as k}from"./UserServices-9109671c.js";import{a as d}from"./AuthServices-0f733033.js";import{T as D}from"./toastify-3acd0462.js";/* empty css                 */import{g as m}from"./photoUtils-c92e179b.js";document.addEventListener("DOMContentLoaded",()=>{feather.replace();const u=document.getElementById("adminProfilePhotoPreview"),c=document.getElementById("adminPhotoUpload"),f=document.getElementById("adminName"),g=document.getElementById("adminEmail"),p=document.getElementById("adminPosition"),y=document.getElementById("adminDepartment"),v=document.getElementById("adminAddress"),h=document.getElementById("adminProfileForm"),B=document.getElementById("adminCancelProfileEditBtn"),i=document.getElementById("adminBaseSalary"),S=document.getElementById("adminToggleSalaryVisibility"),E=document.getElementById("adminSalaryEyeIcon");let w="",n={};const s=(t,a="success")=>{let e;a==="success"?e="linear-gradient(to right, #22c55e, #16a34a)":a==="error"?e="linear-gradient(to right, #ef4444, #dc2626)":e="linear-gradient(to right, #3b82f6, #2563eb)",D({text:t,duration:3e3,close:!0,gravity:"top",position:"right",stopOnFocus:!0,style:{background:e,borderRadius:"8px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",padding:"12px 20px"}}).showToast()},I=async()=>{try{const t=localStorage.getItem("user");if(!t)throw new Error("Sesi tidak valid. Harap login kembali.");const a=JSON.parse(t);if(a.role!=="admin"){s("Akses ditolak. Halaman ini hanya untuk Admin.","error"),setTimeout(()=>d.logout(),1500);return}const e=await k.getUserByID(a.id);if(e){f.value=e.name||"",g.value=e.email||"",p.value=e.position||"",y.value=e.department||"",v.value=e.address||"",w=e.base_salary,i&&(i.value="••••••••••",i.dataset.masked="true",E.setAttribute("data-feather","eye"),feather.replace()),n={name:e.name||"",email:e.email||"",position:e.position||"",department:e.department||"",base_salary:e.base_salary||0,address:e.address||""};const o=document.getElementById("userAvatar");o&&(o.src=await m(a.id,e.name,40)),u.src=await m(a.id,e.name,128)}}catch(t){console.error("Error loading admin profile data:",t),s(t.message||"Gagal memuat data profil admin. Silakan coba lagi.","error"),(t.message.includes("Sesi")||t.status===401||t.status===403)&&setTimeout(()=>d.logout(),2e3)}},P=t=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(t);h&&h.addEventListener("submit",async t=>{t.preventDefault();const a=localStorage.getItem("user");try{if(!a)throw new Error("Sesi tidak valid. Harap login kembali.");const e=JSON.parse(a);if(e.role!=="admin"){s("Akses ditolak. Anda tidak diizinkan mengubah data ini.","error");return}const o=c.files[0],r={};f.value.trim()!==n.name&&(r.name=f.value.trim()),g.value.trim()!==n.email&&(r.email=g.value.trim()),p.value.trim()!==n.position&&(r.position=p.value.trim()),y.value.trim()!==n.department&&(r.department=y.value.trim());const b=parseFloat(i.value.replace(/[^0-9,-]+/g,"").replace(",","."));if(b!==n.base_salary&&!isNaN(b)&&(r.base_salary=b),v.value.trim()!==n.address&&(r.address=v.value.trim()),Object.keys(r).length===0&&!o)return s("Tidak ada perubahan untuk disimpan.","info");if(Object.keys(r).length>0){await k.updateUser(e.id,r);const l=d.getCurrentUser();l&&(r.email&&(l.email=r.email),r.name&&(l.name=r.name),localStorage.setItem("user",JSON.stringify(l)))}if(o){if(o.size>5*1024*1024){s("Ukuran file maksimal adalah 5MB.","error");return}await k.uploadProfilePhoto(e.id,o),u.src=await m(e.id,n.name,128);const A=document.getElementById("userAvatar");A&&(A.src=await m(e.id,n.name,40))}s("Profil admin berhasil diupdate!","success"),I()}catch(e){console.error("Error updating admin profile:",e);const o=e.response&&e.response.data&&e.response.data.error?e.response.data.error:e.message||"Gagal mengupdate profil admin.";s(o,"error"),(e.status===401||e.status===403)&&setTimeout(()=>d.logout(),2e3)}}),B&&B.addEventListener("click",t=>{t.preventDefault(),h.reset(),I(),s("Perubahan dibatalkan.","info")}),S&&S.addEventListener("click",()=>{i.dataset.masked==="true"?(i.value=P(w),i.dataset.masked="false",E.setAttribute("data-feather","eye-off")):(i.value="••••••••••",i.dataset.masked="true",E.setAttribute("data-feather","eye")),feather.replace()}),c&&c.addEventListener("change",function(){if(this.files&&this.files[0]){const t=new FileReader;t.onload=a=>{u.src=a.target.result},t.readAsDataURL(this.files[0])}}),document.querySelectorAll("#logoutButton, #dropdownLogoutButton, #mobileLogoutButton").forEach(t=>{t.addEventListener("click",a=>{a.preventDefault(),d.logout()})}),I()});
