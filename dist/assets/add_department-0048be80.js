import"./input-ac4e21e1.js";import{d as E}from"./DepartemenServices-5d2df75f.js";import{a as x}from"./AuthServices-0f733033.js";import{i as w}from"./sidebarHandler-d6522c99.js";import{i as N}from"./logoutHandler-a2e70173.js";import{Q as T}from"./qrCodeHandler-3c60f548.js";import{T as C}from"./toastify-3acd0462.js";/* empty css                 */import"./AttendanceServices-9bf2f837.js";document.addEventListener("DOMContentLoaded",async()=>{w(),N();const v=(e,r="success")=>{let t;r==="success"?t="linear-gradient(to right, #22c55e, #16a34a)":r==="error"?t="linear-gradient(to right, #ef4444, #dc2626)":t="linear-gradient(to right, #3b82f6, #2563eb)",C({text:e,duration:3e3,close:!0,gravity:"top",position:"right",style:{background:t,borderRadius:"8px"}}).showToast()};T.initialize({toastCallback:v});const u=document.getElementById("addDepartmentForm"),d=document.getElementById("departmentName"),a=document.getElementById("departmentNameError"),o=document.getElementById("departmentErrorMessage"),h=document.getElementById("departmentSuccessMessage"),g=document.getElementById("cancelButton"),i=document.getElementById("submitButton"),p=document.getElementById("submitText"),f=document.getElementById("loadingText");let n=!1;function b(e){const r=e.trim();return r.length>=2&&r.length<=50&&/^[a-zA-Z0-9\s&-]+$/.test(r)}function l(){i.disabled=!n,n?(i.classList.remove("bg-gray-400","cursor-not-allowed"),i.classList.add("bg-teal-600","hover:bg-teal-700")):(i.classList.add("bg-gray-400","cursor-not-allowed"),i.classList.remove("bg-teal-600","hover:bg-teal-700"))}d.addEventListener("blur",function(){const e=this.value.trim();e?b(e)?(n=!0,a.classList.add("hidden"),this.classList.remove("border-red-500")):(n=!1,e.length<2?a.textContent="Nama departemen minimal 2 karakter.":e.length>50?a.textContent="Nama departemen maksimal 50 karakter.":a.textContent="Nama departemen hanya boleh huruf, angka, spasi, &, dan -.",a.classList.remove("hidden"),this.classList.add("border-red-500")):(n=!1,a.textContent="Nama departemen wajib diisi.",a.classList.remove("hidden"),this.classList.add("border-red-500")),l()}),d.addEventListener("input",function(){this.value=this.value.replace(/\s+/g," ");const e=this.value.trim();b(e)?(n=!0,a.classList.add("hidden"),this.classList.remove("border-red-500")):e.length>0?(e.length<2?a.textContent="Nama departemen minimal 2 karakter.":e.length>50?a.textContent="Nama departemen maksimal 50 karakter.":a.textContent="Nama departemen hanya boleh huruf, angka, spasi, &, dan -.",a.classList.remove("hidden"),this.classList.add("border-red-500"),n=!1):(n=!1,a.classList.add("hidden"),this.classList.remove("border-red-500")),l()}),l();const m=(e,r="success",t)=>{t.classList.add("hidden"),t.innerHTML="",r==="success"?(t.innerHTML=e,t.classList.remove("hidden","text-red-600"),t.classList.add("text-green-600")):(t.innerHTML=e,t.classList.remove("hidden","text-green-600"),t.classList.add("text-red-600")),setTimeout(()=>{t.classList.add("hidden"),t.innerHTML=""},5e3)};if(!u){console.error('Formulir tambah departemen tidak ditemukan. Pastikan ID "addDepartmentForm" benar.');return}u.addEventListener("submit",async e=>{if(e.preventDefault(),d.dispatchEvent(new Event("blur")),!n){m("Harap perbaiki kesalahan pada form sebelum melanjutkan.","error",o),d.focus();return}o.classList.add("hidden"),h.classList.add("hidden"),o.textContent="",h.textContent="";const r=d.value.trim(),t=["HR","IT","Finance","Marketing","Sales","Operations","Admin"],y=r.toLowerCase();if(t.some(s=>s.toLowerCase()===y)){m("Departemen ini mungkin sudah ada. Silakan gunakan nama yang lebih spesifik.","error",o);return}const L=localStorage.getItem("token");if(!L){m("Anda tidak terautentikasi. Silakan login ulang.","error",o),x.logout();return}i.disabled=!0,p.classList.add("hidden"),f.classList.remove("hidden"),i.classList.add("bg-gray-400","cursor-not-allowed");try{const s=await E.createDepartment({name:r},L);console.log("Departemen berhasil ditambahkan:",s),m("Departemen berhasil ditambahkan!","success",h),u.reset(),n=!1,d.classList.remove("border-red-500"),a.classList.add("hidden"),setTimeout(()=>{window.location.href="/src/pages/Admin/manage_departments.html"},2e3)}catch(s){console.error("Gagal menambahkan departemen:",s);let c="Terjadi kesalahan saat menambahkan departemen. Silakan coba lagi.";s.details?Array.isArray(s.details)?c=s.details.map(k=>`${k.Field||"Error"}: ${k.Msg}`).join("<br>"):typeof s.details=="string"?c=s.details:s.details.error&&(c=s.details.error):s.message&&(c=s.message),m(c,"error",o)}finally{i.disabled=!1,p.classList.remove("hidden"),f.classList.add("hidden"),l()}}),g&&g.addEventListener("click",()=>{confirm("Apakah Anda yakin ingin membatalkan? Data yang sudah diisi akan hilang.")&&(u.reset(),n=!1,l(),a.classList.add("hidden"),o.classList.add("hidden"),d.classList.remove("border-red-500"),h.classList.add("hidden"),window.location.href="/src/pages/Admin/admin_dashboard.html")})});
