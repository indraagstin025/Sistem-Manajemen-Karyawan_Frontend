import"./input-2ed11044.js";import{u as B,g as S}from"./photoUtils-240b8068.js";import{d as V}from"./DepartemenServices-1b462c09.js";import{a as u}from"./AuthServices-f47c4eb9.js";import{i as W}from"./sidebarHandler-d6522c99.js";import{i as X,S as p}from"./logoutHandler-87b1a96c.js";import{Q as b}from"./qrCodeHandler-01879f51.js";import{T as Z}from"./toastify-3acd0462.js";/* empty css                 */import"./AttendanceServices-f61bdc29.js";document.addEventListener("DOMContentLoaded",async()=>{feather.replace(),W(),X({preLogoutCallback:()=>{typeof b<"u"&&b.close&&b.close()}}),b.initialize({toastCallback:(t,e)=>{let a;e==="success"?a="linear-gradient(to right, #22c55e, #16a34a)":e==="error"?a="linear-gradient(to right, #ef4444, #dc2626)":a="linear-gradient(to right, #3b82f6, #2563eb)",Z({text:t,duration:3e3,close:!0,gravity:"top",position:"right",style:{background:a,borderRadius:"8px"}}).showToast()}});const g=document.getElementById("employeeTableBody"),L=document.getElementById("loadingMessage"),k=document.getElementById("employeeListError"),U=document.getElementById("employeeListSuccess"),D=document.getElementById("paginationInfo"),f=document.getElementById("prevPageBtn"),E=document.getElementById("nextPageBtn"),I=document.getElementById("searchInput"),n=document.getElementById("editEmployeeModal"),C=document.getElementById("closeEditEmployeeModalBtn"),P=document.getElementById("cancelEditEmployeeBtn"),h=document.getElementById("editEmployeeForm"),T=document.getElementById("editErrorMessage"),w=document.getElementById("editSuccessMessage"),F=document.getElementById("editEmployeeId"),N=document.getElementById("editName"),_=document.getElementById("editEmail"),H=document.getElementById("editPosition"),M=document.getElementById("editDepartment"),z=document.getElementById("editBaseSalary"),R=document.getElementById("editAddress"),d=document.getElementById("userAvatar"),l=document.getElementById("userNameNav");document.getElementById("userDropdown"),document.getElementById("dropdownMenu");let y=1;const O=10;let $="",Y="",v=[];const i=(t,e,a="success",o=!1,r=2e3)=>{p.fire({title:t,html:e,icon:a,showConfirmButton:o,timer:r,timerProgressBar:!0,didOpen:s=>{r>0&&(s.addEventListener("mouseenter",p.stopTimer),s.addEventListener("mouseleave",p.resumeTimer))}})},j=async()=>{try{const t=await u.getCurrentUser();if(t&&t.role==="admin"){const e=await S(t.id,t.name,40);d&&(d.src=e,d.alt=t.name||"Admin"),l&&(l.textContent=t.name||"Admin")}else d&&(d.src="/assets/default-avatar.png"),l&&(l.textContent="Guest")}catch(t){console.error("Failed to load admin profile for header:",t),d&&(d.src="/assets/default-avatar.png"),l&&(l.textContent="Error")}},q=async()=>{try{v=await V.getAllDepartments(),M.innerHTML='<option value="">Pilih Departemen</option>',Array.isArray(v)&&v.forEach(e=>{const a=document.createElement("option");a.value=e.name,a.textContent=e.name,M.appendChild(a)})}catch(t){console.error("Failed to load department list for edit modal:",t),i("Error","Failed to load department list. Please try again.","error",!0),(t.status===401||t.status===403)&&setTimeout(()=>u.logout(),2e3)}},c=async()=>{g.innerHTML="",L.classList.remove("hidden"),k.classList.add("hidden"),U.classList.add("hidden");try{const t=await B.getAllUsers(y,O,$,Y);L.classList.add("hidden"),t.data&&t.data.length>0?(await Q(t.data),G(t.total,t.page,t.limit)):(g.innerHTML='<tr><td colspan="8" class="text-center py-4 text-gray-500">No employee data found.</td></tr>',D.textContent="Displaying 0 of 0 employees",f.disabled=!0,E.disabled=!0)}catch(t){console.error("Failed to load employee data:",t),L.classList.add("hidden");let e="Failed to load employee data. Please try again.";t.status===401||t.status===403?(e="Your session has expired or you do not have permission. Please log in again.",setTimeout(()=>u.logout(),2e3)):t.message&&(e=t.message),i("Data Error",e,"error",!0)}},Q=async t=>{g.innerHTML="";for(const e of t){const a=document.createElement("tr");a.className="border-b border-gray-100 hover:bg-gray-50";const o=await S(e.id,e.name,48);a.innerHTML=`
                <td class="px-4 py-3">
                    <img src="${o}" alt="${e.name}" class="h-10 w-10 rounded-full object-cover profile-thumb">
                </td>
                <td class="px-4 py-3 text-sm font-medium text-gray-900">${e.name}</td>
                <td class="px-4 py-3 text-sm text-gray-700">${e.email}</td>
                <td class="px-4 py-3 text-sm text-gray-700 capitalize">${e.role}</td>
                <td class="px-4 py-3 text-sm text-gray-700">${e.position||"-"}</td>
                <td class="px-4 py-3 text-sm text-gray-700">${e.department||"-"}</td>
                <td class="px-4 py-3 text-sm text-gray-700">Rp ${e.base_salary?e.base_salary.toLocaleString("id-ID"):"0"}</td>
                <td class="px-4 py-3 text-sm flex items-center space-x-2">
                    <button class="edit-btn text-blue-600 hover:text-blue-800 transition-colors duration-200 p-1 rounded-md hover:bg-blue-50" title="Edit" data-id="${e.id}">
                        <i data-feather="edit" class="w-5 h-5"></i>
                    </button>
                    <button class="delete-btn text-red-600 hover:text-red-800 transition-colors duration-200 p-1 rounded-md hover:bg-red-50" title="Hapus" data-id="${e.id}" data-name="${e.name}">
                        <i data-feather="trash-2" class="w-5 h-5"></i>
                    </button>
                </td>
            `,g.appendChild(a)}feather.replace(),document.querySelectorAll(".edit-btn").forEach(e=>{e.addEventListener("click",a=>K(a.currentTarget.dataset.id))}),document.querySelectorAll(".delete-btn").forEach(e=>{e.addEventListener("click",a=>J(a.currentTarget.dataset.id,a.currentTarget.dataset.name))})},G=(t,e,a)=>{const o=Math.ceil(t/a),r=(e-1)*a+1,s=Math.min(e*a,t);D.textContent=`Displaying ${r}-${s} of ${t} employees`,f.disabled=e===1,E.disabled=e>=o},K=async t=>{T.classList.add("hidden"),w.classList.add("hidden"),T.textContent="",w.textContent="",v.length===0&&await q();try{const e=await B.getUserByID(t);e?(F.value=e.id,N.value=e.name,_.value=e.email,H.value=e.position||"",M.value=e.department||"",z.value=e.base_salary||0,R.value=e.address||"",n.classList.remove("hidden"),setTimeout(()=>n.classList.add("active"),10)):i("Data Not Found","Employee data not found.","error")}catch(e){console.error("Failed to fetch employee data for edit:",e),i("Failed to Load Data",`Failed to load edit data: ${e.message||"An error occurred"}`,"error",!0),(e.status===401||e.status===403)&&setTimeout(()=>u.logout(),2e3)}},x=()=>{n.classList.remove("active"),setTimeout(()=>{n.classList.add("hidden"),h.reset()},300)};C&&C.addEventListener("click",x),P&&P.addEventListener("click",x),n&&n.addEventListener("click",t=>{t.target===n&&x()}),h&&h.addEventListener("submit",async t=>{t.preventDefault(),T.classList.add("hidden"),w.classList.add("hidden");const e=F.value,a=new FormData(h),o={};for(const[s,m]of a.entries())o[s]=m;if(delete o.id,o.base_salary=parseFloat(o.base_salary),isNaN(o.base_salary)){i("Invalid Input","Base salary must be a valid number.","error",!0);return}const r={name:o.name,email:o.email,position:o.position,department:o.department,base_salary:o.base_salary,address:o.address};try{const s=await B.updateUser(e,r);console.log("Employee successfully updated:",s),i("Success!","Employee successfully updated!","success",!1,1500),setTimeout(()=>{x(),c()},1500)}catch(s){console.error("Failed to update employee:",s);let m="An error occurred while updating the employee. Please try again.";s.details?Array.isArray(s.details)?m=s.details.map(A=>`${A.Field||"Error"}: ${A.Msg}`).join("<br>"):typeof s.details=="string"&&(m=s.details):s.message&&(m=s.message),i("Update Failed",m,"error",!0),(s.status===401||s.status===403)&&setTimeout(()=>u.logout(),2e3)}});const J=async(t,e)=>{p.fire({title:`Delete ${e}?`,text:"This action cannot be undone! Employee data will be permanently deleted.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete!",cancelButtonText:"Cancel"}).then(async a=>{if(a.isConfirmed)try{const o=await B.deleteUser(t);console.log("Employee successfully deleted:",o),p.fire({title:"Deleted!",text:`Employee "${e}" successfully deleted.`,icon:"success",timer:2e3,showConfirmButton:!1}),c()}catch(o){console.error("Failed to delete employee:",o);let r="An error occurred while deleting the employee. Please try again.";o.status===401||o.status===403?(r="You do not have permission to delete this employee.",setTimeout(()=>u.logout(),2e3)):o.message&&(r=o.message),p.fire({title:"Failed",text:r,icon:"error",confirmButtonText:"OK"})}})};if(f&&f.addEventListener("click",()=>{y>1&&(y--,c())}),E&&E.addEventListener("click",()=>{y++,c()}),I){let t;I.addEventListener("input",()=>{clearTimeout(t),t=setTimeout(()=>{$=I.value,y=1,c()},500)})}j(),c()});
