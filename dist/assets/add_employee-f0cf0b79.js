import"./input-2ed11044.js";import{u as A,g as S}from"./photoUtils-240b8068.js";import{d as C}from"./DepartemenServices-1b462c09.js";import{a as v}from"./AuthServices-f47c4eb9.js";import{i as F}from"./sidebarHandler-d6522c99.js";import{i as P}from"./logoutHandler-87b1a96c.js";import{Q as y}from"./qrCodeHandler-01879f51.js";import{T as j}from"./toastify-3acd0462.js";/* empty css                 */import"./AttendanceServices-f61bdc29.js";let a={name:!1,email:!1,password:!1,position:!1,department:!1,salary:!1};function L(t){let s=typeof t=="string"?parseFloat(t.replace(/\D/g,"")):t;return isNaN(s)?"":new Intl.NumberFormat("id-ID",{minimumFractionDigits:0,maximumFractionDigits:0}).format(s)}function E(t){const s=t.replace(/\D/g,"");return parseFloat(s)}function c(){const t=document.getElementById("submitButton");if(!t)return;Object.values(a).every(o=>o)?(t.classList.remove("bg-gray-400","cursor-not-allowed"),t.classList.add("bg-teal-600","hover:bg-teal-700")):(t.classList.add("bg-gray-400","cursor-not-allowed"),t.classList.remove("bg-teal-600","hover:bg-teal-700"))}function k(t){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)}function B(t){return t.trim().length>=2&&/^[a-zA-Z\s]+$/.test(t.trim())}function I(t){const o=/[A-Z]/.test(t),d=/[a-z]/.test(t),l=/[0-9]/.test(t);return t.length>=8&&o&&d&&l}function N(){const t=document.getElementById("name"),s=document.getElementById("email"),o=document.getElementById("password"),d=document.getElementById("position"),l=document.getElementById("department"),i=document.getElementById("base_salary");if(t==null||t.addEventListener("input",function(){const e=document.getElementById("nameError");B(this.value)?(a.name=!0,e.classList.add("hidden")):(a.name=!1,e.textContent="Nama harus minimal 2 karakter dan hanya huruf.",e.classList.remove("hidden")),c()}),s==null||s.addEventListener("input",function(){const e=document.getElementById("emailError");k(this.value)?(a.email=!0,e.classList.add("hidden")):(a.email=!1,e.textContent="Format email tidak valid.",e.classList.remove("hidden")),c()}),o==null||o.addEventListener("input",function(){const e=document.getElementById("passwordError");I(this.value)?(a.password=!0,e.classList.add("hidden")):(a.password=!1,e.textContent="Password harus minimal 8 karakter, mengandung huruf besar, huruf kecil, dan angka.",e.classList.remove("hidden")),c()}),d==null||d.addEventListener("input",function(){const e=document.getElementById("positionError");this.value.trim().length<2?(a.position=!1,e.textContent="Posisi wajib diisi.",e.classList.remove("hidden")):(a.position=!0,e.classList.add("hidden")),c()}),l==null||l.addEventListener("change",function(){const e=document.getElementById("departmentError");this.value?(a.department=!0,e.classList.add("hidden")):(a.department=!1,e.textContent="Departemen wajib dipilih.",e.classList.remove("hidden")),c()}),i==null||i.addEventListener("input",function(){const e=document.getElementById("salaryError");let f=E(this.value);isNaN(f)||f<1?(a.salary=!1,e.textContent="Gaji harus angka positif.",e.classList.remove("hidden")):(a.salary=!0,e.classList.add("hidden"));const g=this.selectionStart,w=this.value.length,b=this.value.replace(/\D/g,"");b?this.value=L(parseFloat(b)):this.value="";const r=this.value.length;this.selectionStart=this.selectionEnd=g+(r-w),c()}),i==null||i.addEventListener("blur",function(){let e=E(this.value);!isNaN(e)&&e>=1?this.value=L(e):this.value!==""&&(this.value=""),c()}),t&&(a.name=B(t.value)),s&&(a.email=k(s.value)),o&&(a.password=I(o.value)),d&&(a.position=d.value.trim().length>=2),l&&(a.department=!!l.value),i){const e=E(i.value||"");a.salary=!isNaN(e)&&e>=1,i.value&&!isNaN(e)&&e>=1?i.value=L(e):i.value&&(i.value="")}c()}function V(){const t=[],s=document.getElementById("name"),o=document.getElementById("email"),d=document.getElementById("password"),l=document.getElementById("position"),i=document.getElementById("department"),e=document.getElementById("base_salary");!s||!B(s.value||"")?(t.push("Nama harus minimal 2 karakter dan hanya huruf."),a.name=!1):a.name=!0,!o||!k(o.value||"")?(t.push("Format email tidak valid."),a.email=!1):a.email=!0,!d||!I(d.value||"")?(t.push("Password harus minimal 8 karakter, mengandung huruf besar, huruf kecil, dan angka."),a.password=!1):a.password=!0,!l||(l.value||"").trim().length<2?(t.push("Posisi wajib diisi."),a.position=!1):a.position=!0,!i||!i.value?(t.push("Departemen wajib dipilih."),a.department=!1):a.department=!0;const f=E((e==null?void 0:e.value)||"");return!e||isNaN(f)||f<1?(t.push("Gaji harus angka positif."),a.salary=!1):a.salary=!0,c(),t}document.addEventListener("DOMContentLoaded",async()=>{feather.replace(),F(),N(),y.initialize({toastCallback:(r,n)=>{g(r,n)}}),P({preLogoutCallback:()=>{typeof y<"u"&&y.close&&y.close()}});const t=document.getElementById("addEmployeeForm"),s=document.getElementById("department"),o=document.getElementById("cancelButton"),d=document.querySelectorAll("#logoutButton"),l=document.getElementById("password"),i=document.getElementById("togglePassword"),e=document.getElementById("userAvatar"),f=document.getElementById("userNameNav");i&&l&&i.addEventListener("click",()=>{const r=l.getAttribute("type")==="password"?"text":"password";l.setAttribute("type",r);const n=i.querySelector("i");r==="password"?n.setAttribute("data-feather","eye-off"):n.setAttribute("data-feather","eye"),feather.replace()});function g(r,n="success"){const m={success:"linear-gradient(to right, #10b981, #14b8a6)",error:"linear-gradient(to right, #ef4444, #dc2626)",warning:"linear-gradient(to right, #f97316, #ea580c)"},p=m[n]||m.error;j({text:r,duration:n==="success"?3e3:-1,close:!0,gravity:"top",position:"center",stopOnFocus:!0,style:{background:p,borderRadius:"8px",padding:"20px 24px",boxShadow:"0 5px 15px rgba(0,0,0,0.3)",maxWidth:"400px",textAlign:"center"},modal:!0}).showToast()}const w=async()=>{try{if(!localStorage.getItem("token"))return;let n=v.getCurrentUser();if(!n||n.role!=="admin")return;const m=await S(n.id,n.name,40);e&&(e.src=m,e.alt=n.name||"Admin"),f&&(f.textContent=n.name||"Admin")}catch(r){console.error("Error fetching admin profile data for header:",r)}};await(async()=>{try{const r=await C.getAllDepartments();s.innerHTML='<option value="">Pilih Departemen</option>',r.forEach(n=>{const m=document.createElement("option");m.value=n.name,m.textContent=n.name,s.appendChild(m)})}catch(r){console.error("Gagal memuat daftar departemen:",r),g("Gagal memuat daftar departemen.","error"),r.status===401&&v.logout()}})(),await w(),t.addEventListener("submit",async r=>{r.preventDefault();const n=V();if(n.length>0){g(n.join("<br>"),"error");return}const m=new FormData(t),p=Object.fromEntries(m.entries());p.role="karyawan";let x=document.getElementById("base_salary").value.replace(/\D/g,"");p.base_salary=parseFloat(x);const D=localStorage.getItem("token");if(!D){v.logout();return}try{await A.registerUser(p,D),g("Karyawan baru berhasil didaftarkan!","success"),t.reset(),N(),setTimeout(()=>{window.location.href="/src/pages/Admin/manage_employees.html"},2e3)}catch(u){console.error("Gagal mendaftarkan karyawan:",u);let h="Terjadi kesalahan server.";u.details&&Array.isArray(u.details.errors)&&u.details.errors.length>0?h=u.details.errors[0].message:u.details&&typeof u.details.error=="string"?h=u.details.error:u.message&&(h=u.message),g(h,"error")}}),o==null||o.addEventListener("click",()=>{confirm("Anda yakin ingin membatalkan? Perubahan tidak akan disimpan.")&&(window.location.href="/src/pages/Admin/manage_employees.html")}),d.forEach(r=>{r==null||r.addEventListener("click",n=>{n.preventDefault(),v.logout()})})});
