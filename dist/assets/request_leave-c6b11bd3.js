import"./input-41369e4a.js";import{a as S}from"./AuthServices-f47c4eb9.js";import{L as _}from"./LeaveRequestsServices-ddeca199.js";import{T as N}from"./toastify-3acd0462.js";/* empty css                 */import{i as q}from"./logoutHandler-87b1a96c.js";import{g as J}from"./photoUtils-240b8068.js";document.addEventListener("DOMContentLoaded",()=>{feather.replace();const E=document.getElementById("userAvatar"),v=document.getElementById("dropdownMenu"),k=document.getElementById("userDropdown"),$=document.getElementById("sidebarToggle"),o=document.getElementById("mobileSidebar"),I=document.getElementById("mobileSidebarPanel"),P=document.getElementById("closeSidebar"),u=document.getElementById("leaveRequestForm"),d=document.getElementById("requestType"),j=document.getElementById("startDate"),U=document.getElementById("endDate");document.getElementById("endDateField"),document.getElementById("reason");const H=document.getElementById("attachmentSection"),B=document.getElementById("attachment"),R=document.getElementById("formMessage"),g=document.getElementById("leaveHistoryTableBody"),A=document.getElementById("leaveHistoryMessage"),D=document.getElementById("paginationControls"),h=document.getElementById("prevPageBtn"),x=document.getElementById("nextPageBtn"),F=document.getElementById("currentPageInfo"),L=document.getElementById("leaveLimitSummary");let s=1;const l=5;let i=[],b=!1;const p=(e,t="success")=>{let a;t==="success"?a="linear-gradient(to right, #22c55e, #16a34a)":t==="error"?a="linear-gradient(to right, #ef4444, #dc2626)":a="linear-gradient(to right, #3b82f6, #2563eb)",N({text:e,duration:3e3,close:!0,gravity:"top",position:"right",stopOnFocus:!0,style:{background:a,borderRadius:"8px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",padding:"12px 20px"}}).showToast()},w=(e,t,a)=>{g.innerHTML="";const n=(t-1)*a,c=n+a,m=e.slice(n,c);if(m.length===0&&t===1){g.innerHTML='<tr><td colspan="6" class="px-6 py-4 text-center text-gray-500">Tidak ada riwayat pengajuan.</td></tr>',A.textContent="Anda belum memiliki riwayat pengajuan cuti atau sakit.",A.classList.remove("hidden","info"),D.classList.add("hidden");return}m.forEach(r=>{const O=g.insertRow();let M=new Date(r.start_date+"T00:00:00").toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric"});if(r.start_date!==r.end_date){const Y=new Date(r.end_date+"T00:00:00").toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric"});M=`${M} - ${Y}`}let y="",f=r.status;switch(r.status){case"pending":y="text-yellow-600",f="Menunggu";break;case"approved":y="text-green-600",f="Disetujui";break;case"rejected":y="text-red-600",f="Ditolak";break;default:y="text-gray-600";break}O.innerHTML=`<td class="px-6 py-4 text-sm text-gray-900">${M}</td><td class="px-6 py-4 text-sm text-gray-700">${r.request_type||"-"}</td><td class="px-6 py-4 text-sm text-gray-700 max-w-xs overflow-hidden text-ellipsis">${r.reason||"-"}</td><td class="px-6 py-4 text-sm ${y} font-semibold">${f}</td><td class="px-6 py-4 text-sm text-gray-700">${r.attachment_url?`<a href="${r.attachment_url}" target="_blank" class="text-teal-600 hover:underline">Lihat Lampiran</a>`:"-"}</td>`})},T=(e,t,a)=>{const n=Math.ceil(e/a);if(n<=1){D.classList.add("hidden");return}D.classList.remove("hidden"),F.textContent=`Halaman ${t} dari ${n}`,h.disabled=t===1,x.disabled=t===n},z=e=>{if(!L||!e)return;const t=new Date().getFullYear();let a=`Anda sudah mengajukan <span class="font-bold">${e.annual_leave_count}</span> kali cuti di tahun ${t}. (Batas: 12 kali)`,n="text-gray-700";e.annual_leave_count>=12?(a=`<span class="font-bold text-red-600">Anda telah mencapai batas maksimal 12 kali pengajuan cuti untuk tahun ${t}.</span>`,n="text-red-600"):e.annual_leave_count>=10&&(n="text-orange-500"),L.innerHTML=`<p class="${n}">ðŸ“… ${a}</p><p class="text-sm text-gray-500 mt-2">Catatan: Pengajuan cuti dapat dilakukan berkali-kali dalam sebulan selama kuota tahunan masih ada.</p>`,L.classList.remove("hidden")},G=()=>{if(h==null||h.addEventListener("click",()=>{s>1&&(s--,w(i,s,l),T(i.length,s,l))}),x==null||x.addEventListener("click",()=>{const e=Math.ceil(i.length/l);s<e&&(s++,w(i,s,l),T(i.length,s,l))}),d==null||d.addEventListener("change",()=>{d.value==="Sakit"?(H.classList.remove("hidden"),B.setAttribute("required","required")):(H.classList.add("hidden"),B.removeAttribute("required"),B.value="")}),u==null||u.addEventListener("submit",async e=>{if(e.preventDefault(),b)return;b=!0,R.classList.add("hidden"),d.value;const t=j.value,a=U.value;if(new Date(t)>new Date(a)){p("Tanggal selesai tidak boleh sebelum tanggal mulai.","error"),b=!1;return}const n=new FormData(u);try{const c=await _.createLeaveRequest(n);p(c.message||"Pengajuan berhasil dikirim!","success"),u.reset(),d.dispatchEvent(new Event("change")),await C()}catch(c){const m=c.message||"Gagal mengirim pengajuan.";p(m,"error")}finally{b=!1}}),k==null||k.addEventListener("click",e=>{e.stopPropagation(),v.classList.toggle("active")}),document.addEventListener("click",()=>v==null?void 0:v.classList.remove("active")),q(),$&&o&&I&&P){const e=()=>{o.classList.remove("hidden"),setTimeout(()=>{o.classList.add("opacity-100"),I.classList.remove("-translate-x-full")},10)},t=()=>{o.classList.remove("opacity-100"),I.classList.add("-translate-x-full"),setTimeout(()=>o.classList.add("hidden"),300)};$.addEventListener("click",e),P.addEventListener("click",t),o.addEventListener("click",a=>{a.target===o&&t()})}},C=async()=>{g.innerHTML='<tr><td colspan="6" class="px-6 py-4 text-center text-gray-500">Memuat data...</td></tr>',L.innerHTML='<p class="text-gray-500">Memuat info...</p>';try{const e=S.getCurrentUser();if(!e||e.role!=="karyawan"){p("Akses ditolak atau sesi tidak valid.","error"),S.logout();return}const[t,a,n]=await Promise.all([_.getMyLeaveRequests(),_.getLeaveSummary(),J(e.id,e.name||"User")]);E&&(E.src=n,E.alt=e.name||"User Avatar"),z(a),i=Array.isArray(t)?t.sort((c,m)=>new Date(m.created_at)-new Date(c.created_at)):[],s=1,w(i,s,l),T(i.length,s,l)}catch(e){console.error("Error initializing page:",e),p(e.message||"Gagal memuat data halaman.","error"),g.innerHTML=`<tr><td colspan="6" class="px-6 py-4 text-center text-red-500">Gagal memuat data: ${e.message}</td></tr>`,(e.status===401||e.status===403)&&S.logout()}};G(),C(),d.dispatchEvent(new Event("change"))});
