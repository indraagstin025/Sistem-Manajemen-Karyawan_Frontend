import"./input-d134dd88.js";import{u as b,g as v}from"./photoUtils-240b8068.js";import{d as A}from"./DepartemenServices-1b462c09.js";import{a as i}from"./AuthServices-f47c4eb9.js";import{i as h,g as S}from"./addEmployeeValidation-0c6de838.js";import{i as x}from"./sidebarHandler-d6522c99.js";import{i as I}from"./logoutHandler-87b1a96c.js";import{Q as l}from"./qrCodeHandler-01879f51.js";import{T as B}from"./toastify-3acd0462.js";/* empty css                 */import"./AttendanceServices-f61bdc29.js";document.addEventListener("DOMContentLoaded",async()=>{feather.replace(),x(),h(),l.initialize({toastCallback:(t,e)=>{o(t,e)}}),I({preLogoutCallback:()=>{typeof l<"u"&&l.close&&l.close()}});const d=document.getElementById("addEmployeeForm"),p=document.getElementById("department"),c=document.getElementById("cancelButton"),w=document.querySelectorAll("#logoutButton"),m=document.getElementById("password"),u=document.getElementById("togglePassword"),g=document.getElementById("userAvatar"),f=document.getElementById("userNameNav");u&&m&&u.addEventListener("click",()=>{const t=m.getAttribute("type")==="password"?"text":"password";m.setAttribute("type",t);const e=u.querySelector("i");t==="password"?e.setAttribute("data-feather","eye-off"):e.setAttribute("data-feather","eye"),feather.replace()});function o(t,e="success"){const r={success:"linear-gradient(to right, #10b981, #14b8a6)",error:"linear-gradient(to right, #ef4444, #dc2626)",warning:"linear-gradient(to right, #f97316, #ea580c)"},n=r[e]||r.error;B({text:t,duration:e==="success"?3e3:-1,close:!0,gravity:"top",position:"center",stopOnFocus:!0,style:{background:n,borderRadius:"8px",padding:"20px 24px",boxShadow:"0 5px 15px rgba(0,0,0,0.3)",maxWidth:"400px",textAlign:"center"},modal:!0}).showToast()}const k=async()=>{try{if(!localStorage.getItem("token"))return;let e=i.getCurrentUser();if(!e||e.role!=="admin")return;const r=await v(e.id,e.name,40);g&&(g.src=r,g.alt=e.name||"Admin"),f&&(f.textContent=e.name||"Admin")}catch(t){console.error("Error fetching admin profile data for header:",t)}};await(async()=>{try{const t=await A.getAllDepartments();p.innerHTML='<option value="">Pilih Departemen</option>',t.forEach(e=>{const r=document.createElement("option");r.value=e.name,r.textContent=e.name,p.appendChild(r)})}catch(t){console.error("Gagal memuat daftar departemen:",t),o("Gagal memuat daftar departemen.","error"),t.status===401&&i.logout()}})(),await k(),d.addEventListener("submit",async t=>{t.preventDefault();const e=S();if(e.length>0){o(e.join("<br>"),"error");return}const r=new FormData(d),n=Object.fromEntries(r.entries());n.role="karyawan";let E=document.getElementById("base_salary").value.replace(/\D/g,"");n.base_salary=parseFloat(E);const y=localStorage.getItem("token");if(!y){i.logout();return}try{await b.registerUser(n,y),o("Karyawan baru berhasil didaftarkan!","success"),d.reset(),h(),setTimeout(()=>{window.location.href="/src/pages/Admin/manage_employees.html"},2e3)}catch(a){console.error("Gagal mendaftarkan karyawan:",a);let s="Terjadi kesalahan server.";a.details&&Array.isArray(a.details.errors)&&a.details.errors.length>0?s=a.details.errors[0].message:a.details&&typeof a.details.error=="string"?s=a.details.error:a.message&&(s=a.message),o(s,"error")}}),c==null||c.addEventListener("click",()=>{confirm("Anda yakin ingin membatalkan? Perubahan tidak akan disimpan.")&&(window.location.href="/src/pages/Admin/manage_employees.html")}),w.forEach(t=>{t==null||t.addEventListener("click",e=>{e.preventDefault(),i.logout()})})});
