import{A as E}from"./AttendanceServices-f61bdc29.js";let i,l,m=!1,c;const h=a=>{const e=document.getElementById("modal-qr-expires-at");l&&clearInterval(l);const o=()=>{if(!e)return;const t=new Date,n=a.getTime()-t.getTime();if(n<=0){clearInterval(l),e.textContent="Kedaluwarsa, menunggu refresh...";return}const d=Math.floor(n/1e3);e.textContent=`Refresh otomatis dalam: ${d} detik`};o(),l=setInterval(o,1e3)},y=a=>{const e=document.getElementById("modal-qr-code-image"),o=document.getElementById("modal-qr-placeholder");if(!e||!o)return;const t=()=>{o.classList.add("hidden"),e.src=a.qr_code_image,e.classList.remove("hidden","opacity-0","scale-95")};e.src&&!e.classList.contains("hidden")?(e.classList.add("opacity-0","scale-95"),setTimeout(t,300)):t()},u=async(a=!1)=>{var o;const e=document.getElementById("modal-qr-placeholder");if(m){console.warn("Proses generate QR sudah berjalan.");return}m=!0,i&&clearTimeout(i),a||e&&(e.textContent="Membuat QR Code...",e.classList.remove("hidden"),(o=document.getElementById("modal-qr-code-image"))==null||o.classList.add("hidden"));try{const t=await E.generateQR();y(t),h(new Date(t.expires_at));const n=new Date(t.expires_at),d=new Date,s=n.getTime()-d.getTime()-5e3;i=setTimeout(()=>{u(!0)},Math.max(s,1e3)),!a&&c&&c("QR Code berhasil dibuat!","success")}catch(t){console.error("Gagal men-generate QR Code:",t),c&&c(t.message||"Gagal membuat QR Code.","error"),e&&(e.textContent="Gagal membuat QR. Coba lagi.")}finally{m=!1}},g=()=>{const a=document.getElementById("qrCodeModal");a&&(a.classList.remove("hidden"),setTimeout(()=>a.classList.add("active"),10),u(!1))},r=()=>{const a=document.getElementById("qrCodeModal");a&&(a.classList.remove("active"),setTimeout(()=>a.classList.add("hidden"),300)),i&&clearTimeout(i),l&&clearInterval(l),m=!1;const e=document.getElementById("modal-qr-code-image");e&&(e.src="",e.classList.add("hidden","opacity-0","scale-95"));const o=document.getElementById("modal-qr-placeholder");o&&(o.classList.remove("hidden"),o.textContent="Memuat QR Code...");const t=document.getElementById("modal-qr-expires-at");t&&(t.textContent="")};function C(a){c=a.toastCallback;const e=document.getElementById("generate-qr-menu-btn"),o=document.getElementById("generate-qr-menu-btn-mobile"),t=document.getElementById("modal-generate-qr-btn"),n=document.getElementById("closeModalBtn"),d=document.getElementById("modal-close-qr-btn"),s=document.getElementById("qrCodeModal");e==null||e.addEventListener("click",g),o==null||o.addEventListener("click",g),t==null||t.addEventListener("click",()=>u(!1)),n==null||n.addEventListener("click",r),d==null||d.addEventListener("click",r),s==null||s.addEventListener("click",f=>{f.target===s&&r()}),window.addEventListener("beforeunload",r)}const L={initialize:C,close:r};export{L as Q};
