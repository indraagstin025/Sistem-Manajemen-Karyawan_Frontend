import"./input-253ff0e0.js";import{u as w,g as L}from"./photoUtils-240b8068.js";import{d as k}from"./DepartemenServices-1b462c09.js";import{a as y}from"./AuthServices-f47c4eb9.js";import{i as B}from"./sidebarHandler-d6522c99.js";import{i as x}from"./logoutHandler-87b1a96c.js";import{Q as v}from"./qrCodeHandler-01879f51.js";import{T as A}from"./toastify-3acd0462.js";/* empty css                 */import"./AttendanceServices-f61bdc29.js";let n={name:!1,email:!1,password:!1,position:!1,department:!1,salary:!1};function c(){const t=document.getElementById("submitButton");if(!t)return;const o=Object.values(n).every(d=>d);t.disabled=!o,o?(t.classList.remove("bg-gray-400","cursor-not-allowed"),t.classList.add("bg-teal-600","hover:bg-teal-700")):(t.classList.add("bg-gray-400","cursor-not-allowed"),t.classList.remove("bg-teal-600","hover:bg-teal-700"))}function D(t){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)}function I(t){return t.trim().length>=2&&/^[a-zA-Z\s]+$/.test(t.trim())}function E(){const t=document.getElementById("name"),o=document.getElementById("email"),d=document.getElementById("password"),u=document.getElementById("position"),l=document.getElementById("department"),m=document.getElementById("base_salary");t==null||t.addEventListener("input",function(){const e=document.getElementById("nameError");I(this.value)?(n.name=!0,e.classList.add("hidden")):(n.name=!1,e.textContent="Nama harus minimal 2 karakter dan hanya huruf.",e.classList.remove("hidden")),c()}),o==null||o.addEventListener("input",function(){const e=document.getElementById("emailError");D(this.value)?(n.email=!0,e.classList.add("hidden")):(n.email=!1,e.textContent="Format email tidak valid.",e.classList.remove("hidden")),c()}),d==null||d.addEventListener("input",function(){const e=document.getElementById("passwordError");this.value.length<6?(n.password=!1,e.textContent="Password minimal 8 karakter dan harus menggunakan Campuran Huruf Besar.",e.classList.remove("hidden")):(n.password=!0,e.classList.add("hidden")),c()}),u==null||u.addEventListener("input",function(){const e=document.getElementById("positionError");this.value.trim().length<2?(n.position=!1,e.textContent="Posisi wajib diisi.",e.classList.remove("hidden")):(n.position=!0,e.classList.add("hidden")),c()}),l==null||l.addEventListener("change",function(){const e=document.getElementById("departmentError");this.value?(n.department=!0,e.classList.add("hidden")):(n.department=!1,e.textContent="Departemen wajib dipilih.",e.classList.remove("hidden")),c()}),m==null||m.addEventListener("input",function(){const e=document.getElementById("salaryError"),f=parseFloat(this.value);isNaN(f)||f<1?(n.salary=!1,e.textContent="Gaji harus angka positif.",e.classList.remove("hidden")):(n.salary=!0,e.classList.add("hidden")),c()}),c()}function C(){return Object.values(n).every(t=>t)}document.addEventListener("DOMContentLoaded",async()=>{feather.replace(),B(),E(),v.initialize({toastCallback:(r,a)=>{g(r,a)}}),x({preLogoutCallback:()=>{typeof v<"u"&&v.close&&v.close()}});const t=document.getElementById("addEmployeeForm"),o=document.getElementById("department"),d=document.getElementById("cancelButton"),u=document.querySelectorAll("#logoutButton"),l=document.getElementById("password"),m=document.getElementById("togglePassword"),e=document.getElementById("userAvatar"),f=document.getElementById("userNameNav");m&&l&&m.addEventListener("click",()=>{const r=l.getAttribute("type")==="password"?"text":"password";l.setAttribute("type",r);const a=m.querySelector("i");r==="password"?a.setAttribute("data-feather","eye-off"):a.setAttribute("data-feather","eye"),feather.replace()});function g(r,a="success"){const s={success:"linear-gradient(to right, #10b981, #14b8a6)",error:"linear-gradient(to right, #ef4444, #dc2626)",warning:"linear-gradient(to right, #f97316, #ea580c)"},p=s[a]||s.error;A({text:r,duration:a==="success"?3e3:-1,close:!0,gravity:"top",position:"center",stopOnFocus:!0,style:{background:p,borderRadius:"8px",padding:"20px 24px",boxShadow:"0 5px 15px rgba(0,0,0,0.3)",maxWidth:"400px",textAlign:"center"},modal:!0}).showToast()}const b=async()=>{try{if(!localStorage.getItem("token"))return;let a=y.getCurrentUser();if(!a||a.role!=="admin")return;const s=await L(a.id,a.name,40);e&&(e.src=s,e.alt=a.name||"Admin"),f&&(f.textContent=a.name||"Admin")}catch(r){console.error("Error fetching admin profile data for header:",r)}};await(async()=>{try{const r=await k.getAllDepartments();o.innerHTML='<option value="">Pilih Departemen</option>',r.forEach(a=>{const s=document.createElement("option");s.value=a.name,s.textContent=a.name,o.appendChild(s)})}catch(r){console.error("Gagal memuat daftar departemen:",r),g("Gagal memuat daftar departemen.","error"),r.status===401&&y.logout()}})(),await b(),t.addEventListener("submit",async r=>{if(r.preventDefault(),!C()){g("Harap perbaiki semua kesalahan pada form.","error");return}const a=new FormData(t),s=Object.fromEntries(a.entries());s.role="karyawan",s.base_salary=parseFloat(s.base_salary);const p=localStorage.getItem("token");if(!p){y.logout();return}try{await w.registerUser(s,p),g("Karyawan baru berhasil didaftarkan!","success"),t.reset(),E(),setTimeout(()=>{window.location.href="/src/pages/Admin/manage_employees.html"},2e3)}catch(i){console.error("Gagal mendaftarkan karyawan:",i);let h="Terjadi kesalahan server.";i.details&&Array.isArray(i.details.errors)&&i.details.errors.length>0?h=i.details.errors[0].message:i.details&&typeof i.details.error=="string"?h=i.details.error:i.message&&(h=i.message),g(h,"error")}}),d==null||d.addEventListener("click",()=>{confirm("Anda yakin ingin membatalkan? Perubahan tidak akan disimpan.")&&(window.location.href="/src/pages/Admin/manage_employees.html")}),u.forEach(r=>{r==null||r.addEventListener("click",a=>{a.preventDefault(),y.logout()})})});
