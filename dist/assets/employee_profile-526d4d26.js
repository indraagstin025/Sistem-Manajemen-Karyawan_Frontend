import"./input-69042067.js";import{u as I,g as L}from"./photoUtils-240b8068.js";import{a as u}from"./AuthServices-f47c4eb9.js";import{T as F}from"./toastify-3acd0462.js";/* empty css                 */const x=(d,i,c)=>!d||!i||!c?{isValid:!1,message:"Semua kolom password wajib diisi."}:i!==c?{isValid:!1,message:"Password baru dan konfirmasi tidak cocok."}:i.length<8?{isValid:!1,message:"Password baru minimal 8 karakter."}:/[A-Z]/.test(i)?{isValid:!0,message:"Validasi berhasil."}:{isValid:!1,message:"Password baru harus mengandung setidaknya satu huruf kapital."};document.addEventListener("DOMContentLoaded",()=>{feather.replace();const d=document.getElementById("profilePhotoPreview"),i=document.getElementById("photoUpload"),c=document.getElementById("name"),m=document.getElementById("email"),B=document.getElementById("position"),k=document.getElementById("department"),f=document.getElementById("address"),g=document.getElementById("profileForm"),p=document.getElementById("changePasswordFormProfile"),h=document.getElementById("showPasswordCheckbox"),S=document.querySelectorAll("#logoutButton, #dropdownLogoutButton, #mobileLogoutButton"),b=document.getElementById("cancelProfileEditBtn"),n=document.getElementById("base_salary"),v=document.getElementById("toggleSalaryVisibility"),y=document.getElementById("salaryEyeIcon");let P="",E={};const s=(t,a="success")=>{let e;a==="success"?e="linear-gradient(to right, #22c55e, #16a34a)":a==="error"?e="linear-gradient(to right, #ef4444, #dc2626)":e="linear-gradient(to right, #3b82f6, #2563eb)",F({text:t,duration:3e3,close:!0,gravity:"top",position:"right",stopOnFocus:!0,style:{background:e,borderRadius:"8px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",padding:"12px 20px"}}).showToast()},w=async()=>{try{const t=localStorage.getItem("user");if(!t)throw new Error("Sesi tidak valid. Harap login kembali.");const a=JSON.parse(t),e=await I.getUserByID(a.id);if(e){c.value=e.name||"",m.value=e.email||"",B.value=e.position||"",k.value=e.department||"",f.value=e.address||"",P=e.base_salary,n&&(n.value="••••••••••",n.dataset.masked="true",y.setAttribute("data-feather","eye"),feather.replace()),E={email:e.email||"",address:e.address||""};const o=await L(a.id,e.name);d&&(d.src=o);const r=document.getElementById("userAvatar");r&&(r.src=o)}}catch(t){console.error("Error loading profile data:",t),s(t.message||"Gagal memuat data profil. Silakan coba lagi.","error"),(t.message.includes("Sesi")||t.status===401||t.status===403)&&setTimeout(()=>u.logout(),2e3)}},D=t=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(t);g&&g.addEventListener("submit",async t=>{t.preventDefault();const a=localStorage.getItem("user");try{if(!a)throw new Error("Sesi tidak valid. Harap login kembali.");const e=JSON.parse(a),o=i.files[0],r={};if(m.value.trim()!==E.email&&(r.email=m.value.trim()),f.value.trim()!==E.address&&(r.address=f.value.trim()),Object.keys(r).length===0&&!o)return s("Tidak ada perubahan untuk disimpan.","info");if(Object.keys(r).length>0){await I.updateUser(e.id,r);const l=u.getCurrentUser();l&&r.email&&(l.email=r.email,localStorage.setItem("user",JSON.stringify(l)))}if(o){if(o.size>5*1024*1024){s("Ukuran file maksimal adalah 5MB.","error");return}await I.uploadProfilePhoto(e.id,o)}s("Profil berhasil diupdate!","success"),await w()}catch(e){console.error("Error updating profile:",e),s(e.message||"Gagal mengupdate profil.","error"),(e.status===401||e.status===403)&&setTimeout(()=>u.logout(),2e3)}}),b&&b.addEventListener("click",t=>{t.preventDefault(),g.reset(),w(),s("Perubahan dibatalkan.","info")}),v&&v.addEventListener("click",()=>{n.dataset.masked==="true"?(n.value=D(P),n.dataset.masked="false",y.setAttribute("data-feather","eye-off")):(n.value="••••••••••",n.dataset.masked="true",y.setAttribute("data-feather","eye")),feather.replace()}),p&&p.addEventListener("submit",async t=>{t.preventDefault();const a=document.getElementById("oldPasswordProfile").value,e=document.getElementById("newPasswordProfile").value,o=document.getElementById("confirmNewPasswordProfile").value,r=x(a,e,o);if(!r.isValid)return s(r.message,"error");try{await u.changePassword(a,e),s("Password berhasil diubah!","success"),p.reset()}catch(l){console.error("Error changing password:",l),s(l.message||"Gagal mengubah password.","error")}}),h&&h.addEventListener("change",()=>{const t=h.checked;[document.getElementById("oldPasswordProfile"),document.getElementById("newPasswordProfile"),document.getElementById("confirmNewPasswordProfile")].forEach(e=>{e&&(e.type=t?"text":"password")})}),i&&i.addEventListener("change",function(){if(this.files&&this.files[0]){const t=new FileReader;t.onload=a=>{d.src=a.target.result},t.readAsDataURL(this.files[0])}}),S.forEach(t=>{t.addEventListener("click",a=>{a.preventDefault(),u.logout()})}),w()});
