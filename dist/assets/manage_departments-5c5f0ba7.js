import"./input-d134dd88.js";import{d as T}from"./DepartemenServices-1b462c09.js";import{a as v}from"./AuthServices-f47c4eb9.js";import{i as Q}from"./sidebarHandler-d6522c99.js";import{i as Y,S as m}from"./logoutHandler-87b1a96c.js";import{Q as D}from"./qrCodeHandler-01879f51.js";import{g as q}from"./photoUtils-240b8068.js";import{T as j}from"./toastify-3acd0462.js";import"./AttendanceServices-f61bdc29.js";document.addEventListener("DOMContentLoaded",async()=>{feather.replace(),Q(),Y({preLogoutCallback:()=>{typeof D<"u"&&D.close&&D.close()}}),D.initialize({toastCallback:(e,t)=>{let r;t==="success"?r="linear-gradient(to right, #22c55e, #16a34a)":t==="error"?r="linear-gradient(to right, #ef4444, #dc2626)":r="linear-gradient(to right, #3b82f6, #2563eb)",j({text:e,duration:3e3,close:!0,gravity:"top",position:"right",style:{background:r,borderRadius:"8px"}}).showToast()}});const g=document.getElementById("departmentTableBody"),B=document.getElementById("loadingMessage"),F=document.getElementById("departmentListError"),N=document.getElementById("departmentListSuccess"),w=document.getElementById("paginationInfo"),f=document.getElementById("prevPageBtn"),h=document.getElementById("nextPageBtn"),L=document.getElementById("searchInput"),o=document.getElementById("editDepartmentModal"),M=document.getElementById("closeEditDepartmentModalBtn"),C=document.getElementById("cancelEditDepartmentBtn"),b=document.getElementById("editDepartmentForm"),A=document.getElementById("editDepartmentErrorMessage"),P=document.getElementById("editDepartmentSuccessMessage"),S=document.getElementById("editDepartmentId"),$=document.getElementById("editDepartmentName"),i=document.getElementById("userAvatar"),c=document.getElementById("userNameNav");document.getElementById("userDropdown"),document.getElementById("dropdownMenu");let d=1;const l=10;let x=[],u=[],k="";const y=(e,t,r="success",a=!1,n=2e3)=>{m.fire({title:e,html:t,icon:r,showConfirmButton:a,timer:n,timerProgressBar:!0,didOpen:s=>{n>0&&(s.addEventListener("mouseenter",m.stopTimer),s.addEventListener("mouseleave",m.resumeTimer))}})},H=async()=>{try{const e=await v.getCurrentUser();if(e&&e.role==="admin"){const t=await q(e.id,e.name,40);i&&(i.src=t,i.alt=e.name||"Admin"),c&&(c.textContent=e.name||"Admin")}else i&&(i.src="/assets/default-avatar.png"),c&&(c.textContent="Guest")}catch(e){console.error("Failed to load admin profile for header:",e),i&&(i.src="/assets/default-avatar.png"),c&&(c.textContent="Error")}},I=async()=>{g.innerHTML="",B.classList.remove("hidden"),F.classList.add("hidden"),N.classList.add("hidden");try{const e=await T.getAllDepartments();B.classList.add("hidden"),Array.isArray(e)?x=e.sort((t,r)=>new Date(r.created_at)-new Date(t.created_at)):(console.warn("Warning: API did not return an array of departments. Received:",e),x=[]),p()}catch(e){B.classList.add("hidden");let t="Failed to load department data.";e.status===401||e.status===403?(t="Your session has expired or you do not have permission. Please log in again.",setTimeout(()=>v.logout(),2e3)):e.message&&(t=e.message),y("Data Error",t,"error",!0)}},p=()=>{u=x.filter(e=>e.name.toLowerCase().includes(k.toLowerCase())),u.length===0?(g.innerHTML='<tr><td colspan="3" class="text-center py-4 text-gray-500">No department data found.</td></tr>',w.textContent="Displaying 0 of 0 departments",f.disabled=!0,h.disabled=!0):(U(u),R(u.length))},U=e=>{g.innerHTML="";const t=(d-1)*l,r=t+l,a=e.slice(t,r);if(a.length===0&&d>1){d--,p();return}a.forEach(n=>{const s=document.createElement("tr");s.className="border-b border-gray-100 hover:bg-gray-50";const O=new Date(n.created_at).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric"});s.innerHTML=`
                <td class="px-4 py-3 text-sm font-medium text-gray-900">${n.name}</td>
                <td class="px-4 py-3 text-sm text-gray-700">${O}</td>
                <td class="px-4 py-3 text-sm flex items-center space-x-2">
                    <button class="edit-btn text-blue-600 hover:text-blue-800 transition-colors duration-200 p-1 rounded-md hover:bg-blue-50" title="Edit" data-id="${n.id}" data-name="${n.name}">
                        <i data-feather="edit" class="w-5 h-5"></i>
                    </button>
                    <button class="delete-btn text-red-600 hover:text-red-800 transition-colors duration-200 p-1 rounded-md hover:bg-red-50" title="Hapus" data-id="${n.id}" data-name="${n.name}">
                        <i data-feather="trash-2" class="w-5 h-5"></i>
                    </button>
                </td>
            `,g.appendChild(s)}),feather.replace(),document.querySelectorAll(".edit-btn").forEach(n=>{n.addEventListener("click",s=>_(s.currentTarget.dataset.id,s.currentTarget.dataset.name))}),document.querySelectorAll(".delete-btn").forEach(n=>{n.addEventListener("click",s=>z(s.currentTarget.dataset.id,s.currentTarget.dataset.name))})},R=e=>{const t=Math.ceil(e/l),r=(d-1)*l+1,a=Math.min(d*l,e);w.textContent=`Displaying ${r}-${a} of ${e} departments`,f.disabled=d===1,h.disabled=d>=t},_=(e,t)=>{A.classList.add("hidden"),P.classList.add("hidden"),S.value=e,$.value=t,o.classList.remove("hidden"),setTimeout(()=>o.classList.add("active"),10)},E=()=>{o.classList.remove("active"),setTimeout(()=>{o.classList.add("hidden"),b.reset()},300)};M&&M.addEventListener("click",E),C&&C.addEventListener("click",E),o&&o.addEventListener("click",e=>{e.target===o&&E()});const z=async(e,t)=>{m.fire({title:`Delete ${t}?`,text:"This action cannot be undone! This department will be permanently deleted.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete!",cancelButtonText:"Cancel"}).then(async r=>{if(r.isConfirmed)try{await T.deleteDepartment(e),m.fire({title:"Deleted!",text:`Department "${t}" successfully deleted.`,icon:"success",timer:2e3,showConfirmButton:!1}),I()}catch(a){console.error("Failed to delete department:",a);let n="An error occurred while deleting the department. Please try again.";a.status===401||a.status===403?(n="You do not have permission to delete this department.",setTimeout(()=>v.logout(),2e3)):a.message&&(n=a.message),m.fire({title:"Failed",text:n,icon:"error",confirmButtonText:"OK"})}})};if(b&&b.addEventListener("submit",async e=>{e.preventDefault(),A.classList.add("hidden"),P.classList.add("hidden");const t=S.value,r=$.value.trim();if(!r){y("Validation Failed","Department name cannot be empty.","error");return}try{await T.updateDepartment(t,{name:r}),y("Success!","Department successfully updated!","success",!1,1500),setTimeout(()=>{E(),I()},1500)}catch(a){console.error("Failed to update department:",a);let n="An error occurred while updating the department. Please try again.";a.details?Array.isArray(a.details)?n=a.details.map(s=>`${s.Field||"Error"}: ${s.Msg}`).join("<br>"):typeof a.details=="string"&&(n=a.details):a.message&&(n=a.message),y("Update Failed",n,"error",!0),(a.status===401||a.status===403)&&setTimeout(()=>v.logout(),2e3)}}),f&&f.addEventListener("click",()=>{d>1&&(d--,p())}),h&&h.addEventListener("click",()=>{const e=Math.ceil(u.length/l);d<e&&(d++,p())}),L){let e;L.addEventListener("input",()=>{clearTimeout(e),e=setTimeout(()=>{k=L.value,d=1,p()},500)})}await H(),I()});
