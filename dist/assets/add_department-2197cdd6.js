import"./input-69042067.js";import{d as w}from"./DepartemenServices-1b462c09.js";import{a as E}from"./AuthServices-f47c4eb9.js";import{i as B}from"./sidebarHandler-d6522c99.js";import{i as C}from"./logoutHandler-87b1a96c.js";import{Q as I}from"./qrCodeHandler-01879f51.js";import{g as T}from"./photoUtils-240b8068.js";import{T as A}from"./toastify-3acd0462.js";/* empty css                 */import"./AttendanceServices-f61bdc29.js";document.addEventListener("DOMContentLoaded",async()=>{feather.replace(),B(),C();const N=(e,a="success")=>{let t;a==="success"?t="linear-gradient(to right, #22c55e, #16a34a)":a==="error"?t="linear-gradient(to right, #ef4444, #dc2626)":t="linear-gradient(to right, #3b82f6, #2563eb)",A({text:e,duration:3e3,close:!0,gravity:"top",position:"right",style:{background:t,borderRadius:"8px"}}).showToast()};I.initialize({toastCallback:N});const g=document.getElementById("userAvatar"),f=document.getElementById("userNameNav"),u=document.getElementById("addDepartmentForm"),d=document.getElementById("departmentName"),s=document.getElementById("departmentNameError"),o=document.getElementById("departmentErrorMessage"),h=document.getElementById("departmentSuccessMessage"),p=document.getElementById("cancelButton"),i=document.getElementById("submitButton"),b=document.getElementById("submitText"),L=document.getElementById("loadingText");let r=!1;function k(e){const a=e.trim();return a.length>=2&&a.length<=50&&/^[a-zA-Z0-9\s&-]+$/.test(a)}function l(){i.disabled=!r,r?(i.classList.remove("bg-gray-400","cursor-not-allowed"),i.classList.add("bg-teal-600","hover:bg-teal-700")):(i.classList.add("bg-gray-400","cursor-not-allowed"),i.classList.remove("bg-teal-600","hover:bg-teal-700"))}d.addEventListener("blur",function(){const e=this.value.trim();e?k(e)?(r=!0,s.classList.add("hidden"),this.classList.remove("border-red-500")):(r=!1,e.length<2?s.textContent="Nama departemen minimal 2 karakter.":e.length>50?s.textContent="Nama departemen maksimal 50 karakter.":s.textContent="Nama departemen hanya boleh huruf, angka, spasi, &, dan -.",s.classList.remove("hidden"),this.classList.add("border-red-500")):(r=!1,s.textContent="Nama departemen wajib diisi.",s.classList.remove("hidden"),this.classList.add("border-red-500")),l()}),d.addEventListener("input",function(){this.value=this.value.replace(/\s+/g," ");const e=this.value.trim();k(e)?(r=!0,s.classList.add("hidden"),this.classList.remove("border-red-500")):e.length>0?(e.length<2?s.textContent="Nama departemen minimal 2 karakter.":e.length>50?s.textContent="Nama departemen maksimal 50 karakter.":s.textContent="Nama departemen hanya boleh huruf, angka, spasi, &, dan -.",s.classList.remove("hidden"),this.classList.add("border-red-500"),r=!1):(r=!1,s.classList.add("hidden"),this.classList.remove("border-red-500")),l()}),l();const m=(e,a="success",t)=>{t.classList.add("hidden"),t.innerHTML="",a==="success"?(t.innerHTML=e,t.classList.remove("hidden","text-red-600"),t.classList.add("text-green-600")):(t.innerHTML=e,t.classList.remove("hidden","text-green-600"),t.classList.add("text-red-600")),setTimeout(()=>{t.classList.add("hidden"),t.innerHTML=""},5e3)};if(!u){console.error('Formulir tambah departemen tidak ditemukan. Pastikan ID "addDepartmentForm" benar.');return}await(async()=>{try{if(!localStorage.getItem("token"))return;const a=E.getCurrentUser();if(!a||a.role!=="admin")return;const t=await T(a.id,a.name,40);g&&(g.src=t,g.alt=a.name||"Admin"),f&&(f.textContent=a.name||"Admin")}catch(e){console.error("Error fetching admin profile data for header:",e)}})(),u.addEventListener("submit",async e=>{if(e.preventDefault(),d.dispatchEvent(new Event("blur")),!r){m("Harap perbaiki semua kesalahan pada form sebelum melanjutkan.","error",o),d.focus();return}o.classList.add("hidden"),h.classList.add("hidden"),o.textContent="",h.textContent="";const a=d.value.trim(),t=["HR","IT","Finance","Marketing","Sales","Operations","Admin"],x=a.toLowerCase();if(t.some(n=>n.toLowerCase()===x)){m("Departemen ini mungkin sudah ada. Silakan gunakan nama yang lebih spesifik.","error",o);return}const v=localStorage.getItem("token");if(!v){m("Anda tidak terautentikasi. Silakan login ulang.","error",o),E.logout();return}i.disabled=!0,b.classList.add("hidden"),L.classList.remove("hidden"),i.classList.add("bg-gray-400","cursor-not-allowed");try{const n=await w.createDepartment({name:a},v);console.log("Departemen berhasil ditambahkan:",n),m("Departemen berhasil ditambahkan!","success",h),u.reset(),r=!1,d.classList.remove("border-red-500"),s.classList.add("hidden"),l(),setTimeout(()=>{window.location.href="/src/pages/Admin/manage_departments.html"},2e3)}catch(n){console.error("Gagal menambahkan departemen:",n);let c="Terjadi kesalahan saat menambahkan departemen. Silakan coba lagi.";n.details?Array.isArray(n.details)?c=n.details.map(y=>`${y.Field||"Error"}: ${y.Msg}`).join("<br>"):typeof n.details=="string"?c=n.details:n.details.error&&(c=n.details.error):n.message&&(c=n.message),m(c,"error",o)}finally{i.disabled=!1,b.classList.remove("hidden"),L.classList.add("hidden"),l()}}),p&&p.addEventListener("click",()=>{confirm("Apakah Anda yakin ingin membatalkan? Data yang sudah diisi akan hilang.")&&(u.reset(),r=!1,l(),s.classList.add("hidden"),o.classList.add("hidden"),d.classList.remove("border-red-500"),h.classList.add("hidden"),window.location.href="/src/pages/Admin/admin_dashboard.html")})});
