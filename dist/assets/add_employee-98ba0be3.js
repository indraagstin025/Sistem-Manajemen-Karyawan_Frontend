import"./input-2ed11044.js";import{u as w,g as L}from"./photoUtils-240b8068.js";import{d as B}from"./DepartemenServices-1b462c09.js";import{a as y}from"./AuthServices-f47c4eb9.js";import{i as A}from"./sidebarHandler-d6522c99.js";import{i as x}from"./logoutHandler-87b1a96c.js";import{Q as v}from"./qrCodeHandler-01879f51.js";import{T as D}from"./toastify-3acd0462.js";/* empty css                 */import"./AttendanceServices-f61bdc29.js";let n={name:!1,email:!1,password:!1,position:!1,department:!1,salary:!1};function u(){const e=document.getElementById("submitButton");if(!e)return;Object.values(n).every(s=>s)?(e.classList.remove("bg-gray-400","cursor-not-allowed"),e.classList.add("bg-teal-600","hover:bg-teal-700")):(e.classList.add("bg-gray-400","cursor-not-allowed"),e.classList.remove("bg-teal-600","hover:bg-teal-700"))}function I(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}function C(e){return e.trim().length>=2&&/^[a-zA-Z\s]+$/.test(e.trim())}function P(e){const s=/[A-Z]/.test(e),m=/[a-z]/.test(e),l=/[0-9]/.test(e);return e.length>=8&&s&&m&&l}function b(){const e=document.getElementById("name"),d=document.getElementById("email"),s=document.getElementById("password"),m=document.getElementById("position"),l=document.getElementById("department"),c=document.getElementById("base_salary");e==null||e.addEventListener("input",function(){const t=document.getElementById("nameError");C(this.value)?(n.name=!0,t.classList.add("hidden")):(n.name=!1,t.textContent="Nama harus minimal 2 karakter dan hanya huruf.",t.classList.remove("hidden")),u()}),d==null||d.addEventListener("input",function(){const t=document.getElementById("emailError");I(this.value)?(n.email=!0,t.classList.add("hidden")):(n.email=!1,t.textContent="Format email tidak valid.",t.classList.remove("hidden")),u()}),s==null||s.addEventListener("input",function(){const t=document.getElementById("passwordError");P(this.value)?(n.password=!0,t.classList.add("hidden")):(n.password=!1,t.textContent="Password harus minimal 8 karakter, mengandung huruf besar, huruf kecil, dan angka.",t.classList.remove("hidden")),u()}),m==null||m.addEventListener("input",function(){const t=document.getElementById("positionError");this.value.trim().length<2?(n.position=!1,t.textContent="Posisi wajib diisi.",t.classList.remove("hidden")):(n.position=!0,t.classList.add("hidden")),u()}),l==null||l.addEventListener("change",function(){const t=document.getElementById("departmentError");this.value?(n.department=!0,t.classList.add("hidden")):(n.department=!1,t.textContent="Departemen wajib dipilih.",t.classList.remove("hidden")),u()}),c==null||c.addEventListener("input",function(){const t=document.getElementById("salaryError"),g=parseFloat(this.value);isNaN(g)||g<1?(n.salary=!1,t.textContent="Gaji harus angka positif.",t.classList.remove("hidden")):(n.salary=!0,t.classList.add("hidden")),u()}),u()}function N(){const e=[];return n.name||e.push("Nama harus minimal 2 karakter dan hanya huruf."),n.email||e.push("Format email tidak valid."),n.password||e.push("Password harus minimal 8 karakter, mengandung huruf besar, huruf kecil, dan angka."),n.position||e.push("Posisi wajib diisi."),n.department||e.push("Departemen wajib dipilih."),n.salary||e.push("Gaji harus angka positif."),e}document.addEventListener("DOMContentLoaded",async()=>{feather.replace(),A(),b(),v.initialize({toastCallback:(r,a)=>{p(r,a)}}),x({preLogoutCallback:()=>{typeof v<"u"&&v.close&&v.close()}});const e=document.getElementById("addEmployeeForm"),d=document.getElementById("department"),s=document.getElementById("cancelButton"),m=document.querySelectorAll("#logoutButton"),l=document.getElementById("password"),c=document.getElementById("togglePassword"),t=document.getElementById("userAvatar"),g=document.getElementById("userNameNav");c&&l&&c.addEventListener("click",()=>{const r=l.getAttribute("type")==="password"?"text":"password";l.setAttribute("type",r);const a=c.querySelector("i");r==="password"?a.setAttribute("data-feather","eye-off"):a.setAttribute("data-feather","eye"),feather.replace()});function p(r,a="success"){const o={success:"linear-gradient(to right, #10b981, #14b8a6)",error:"linear-gradient(to right, #ef4444, #dc2626)",warning:"linear-gradient(to right, #f97316, #ea580c)"},f=o[a]||o.error;D({text:r,duration:a==="success"?3e3:-1,close:!0,gravity:"top",position:"center",stopOnFocus:!0,style:{background:f,borderRadius:"8px",padding:"20px 24px",boxShadow:"0 5px 15px rgba(0,0,0,0.3)",maxWidth:"400px",textAlign:"center"},modal:!0}).showToast()}const k=async()=>{try{if(!localStorage.getItem("token"))return;let a=y.getCurrentUser();if(!a||a.role!=="admin")return;const o=await L(a.id,a.name,40);t&&(t.src=o,t.alt=a.name||"Admin"),g&&(g.textContent=a.name||"Admin")}catch(r){console.error("Error fetching admin profile data for header:",r)}};await(async()=>{try{const r=await B.getAllDepartments();d.innerHTML='<option value="">Pilih Departemen</option>',r.forEach(a=>{const o=document.createElement("option");o.value=a.name,o.textContent=a.name,d.appendChild(o)})}catch(r){console.error("Gagal memuat daftar departemen:",r),p("Gagal memuat daftar departemen.","error"),r.status===401&&y.logout()}})(),await k(),e.addEventListener("submit",async r=>{r.preventDefault();const a=N();if(a.length>0){p(a.join("<br>"),"error");return}const o=new FormData(e),f=Object.fromEntries(o.entries());f.role="karyawan",f.base_salary=parseFloat(f.base_salary);const E=localStorage.getItem("token");if(!E){y.logout();return}try{await w.registerUser(f,E),p("Karyawan baru berhasil didaftarkan!","success"),e.reset(),b(),setTimeout(()=>{window.location.href="/src/pages/Admin/manage_employees.html"},2e3)}catch(i){console.error("Gagal mendaftarkan karyawan:",i);let h="Terjadi kesalahan server.";i.details&&Array.isArray(i.details.errors)&&i.details.errors.length>0?h=i.details.errors[0].message:i.details&&typeof i.details.error=="string"?h=i.details.error:i.message&&(h=i.message),p(h,"error")}}),s==null||s.addEventListener("click",()=>{confirm("Anda yakin ingin membatalkan? Perubahan tidak akan disimpan.")&&(window.location.href="/src/pages/Admin/manage_employees.html")}),m.forEach(r=>{r==null||r.addEventListener("click",a=>{a.preventDefault(),y.logout()})})});
