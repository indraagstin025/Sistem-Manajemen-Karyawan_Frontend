import"./input-69042067.js";import{a as P}from"./AuthServices-f47c4eb9.js";import{L as $}from"./LeaveRequestsServices-ddeca199.js";import{T as N}from"./toastify-3acd0462.js";/* empty css                 */import{i as J}from"./logoutHandler-87b1a96c.js";import{g as K}from"./photoUtils-240b8068.js";document.addEventListener("DOMContentLoaded",()=>{feather.replace();const I=document.getElementById("userAvatar"),f=document.getElementById("dropdownMenu"),B=document.getElementById("userDropdown"),A=document.getElementById("sidebarToggle"),d=document.getElementById("mobileSidebar"),D=document.getElementById("mobileSidebarPanel"),C=document.getElementById("closeSidebar"),v=document.getElementById("leaveRequestForm"),i=document.getElementById("requestType"),l=document.getElementById("startDate"),c=document.getElementById("endDate"),S=document.getElementById("endDateField"),U=document.getElementById("reason"),T=document.getElementById("attachmentSection"),y=document.getElementById("attachment"),F=document.getElementById("formMessage"),L=document.getElementById("leaveHistoryTableBody");document.getElementById("leaveHistoryMessage");const H=document.getElementById("paginationControls"),x=document.getElementById("prevPageBtn"),E=document.getElementById("nextPageBtn"),R=document.getElementById("currentPageInfo"),k=document.getElementById("leaveLimitSummary");let r=1;const m=5;let o=[],h=!1;const u=(e,a="success")=>{let t;a==="success"?t="linear-gradient(to right, #22c55e, #16a34a)":a==="error"?t="linear-gradient(to right, #ef4444, #dc2626)":t="linear-gradient(to right, #3b82f6, #2563eb)",N({text:e,duration:3e3,close:!0,gravity:"top",position:"right",stopOnFocus:!0,style:{background:t,borderRadius:"8px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",padding:"12px 20px"}}).showToast()},M=(e,a,t)=>{L.innerHTML="";const n=(a-1)*t,g=n+t;e.slice(n,g).forEach(s=>{const G=L.insertRow(),O=new Date(s.start_date+"T00:00:00").toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric"}),Y=s.start_date!==s.end_date?new Date(s.end_date+"T00:00:00").toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric"}):"-";let b="",w=s.status;switch(s.status){case"pending":b="text-yellow-600",w="Menunggu";break;case"approved":b="text-green-600",w="Disetujui";break;case"rejected":b="text-red-600",w="Ditolak";break;default:b="text-gray-600";break}G.innerHTML=`
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${O}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">${Y}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">${s.request_type||"-"}</td>
            <td class="px-6 py-4 text-sm text-gray-700 max-w-xs overflow-hidden text-ellipsis">${s.reason||"-"}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm ${b} font-semibold">${w}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                ${s.attachment_url?`<a href="${s.attachment_url}" target="_blank" class="text-teal-600 hover:underline">Lihat</a>`:"-"}
            </td>
        `})},_=(e,a,t)=>{const n=Math.ceil(e/t);if(n<=1){H.classList.add("hidden");return}H.classList.remove("hidden"),R.textContent=`Halaman ${a} dari ${n}`,x.disabled=a===1,E.disabled=a===n},q=e=>{if(!k||!e)return;const a=new Date().getFullYear();let t=`Anda sudah mengajukan <span class="font-bold">${e.annual_leave_count}</span> kali cuti di tahun ${a}. (Batas: 12 kali)`,n="text-gray-700";e.annual_leave_count>=12?(t=`<span class="font-bold text-red-600">Anda telah mencapai batas maksimal 12 kali pengajuan cuti untuk tahun ${a}.</span>`,n="text-red-600"):e.annual_leave_count>=10&&(n="text-orange-500"),k.innerHTML=`<p class="${n}">ðŸ“… ${t}</p><p class="text-sm text-gray-500 mt-2">Catatan: Pengajuan cuti dapat dilakukan berkali-kali dalam sebulan selama kuota tahunan masih ada.</p>`,k.classList.remove("hidden")},z=()=>{if(x==null||x.addEventListener("click",()=>{r>1&&(r--,M(o,r,m),_(o.length,r,m))}),E==null||E.addEventListener("click",()=>{const e=Math.ceil(o.length/m);r<e&&(r++,M(o,r,m),_(o.length,r,m))}),i==null||i.addEventListener("change",()=>{const e=i.value;e==="Sakit"?(T.classList.remove("hidden"),y.setAttribute("required","required"),S.classList.remove("hidden"),c.removeAttribute("disabled")):e==="Cuti"?(T.classList.add("hidden"),y.removeAttribute("required"),y.value="",S.classList.add("hidden"),c.setAttribute("disabled","disabled"),l.value&&(c.value=l.value)):(T.classList.add("hidden"),y.removeAttribute("required"),y.value="",S.classList.remove("hidden"),c.removeAttribute("disabled"))}),l==null||l.addEventListener("change",()=>{i.value==="Cuti"&&(c.value=l.value)}),v==null||v.addEventListener("submit",async e=>{if(e.preventDefault(),h)return;h=!0,F.classList.add("hidden");const a=i.value,t=l.value;let n=c.value;if(a==="Cuti"&&(n=t,c.value=t),new Date(t)>new Date(n)){u("Tanggal selesai tidak boleh sebelum tanggal mulai.","error"),h=!1;return}if(!a||!t||!n){u("Mohon lengkapi semua field yang diperlukan.","error"),h=!1;return}console.log("Form submission data:",{requestType:a,startDate:t,endDate:n,reason:U.value});const g=new FormData(v);g.set("end_date",n);try{const p=await $.createLeaveRequest(g);u(p.message||"Pengajuan berhasil dikirim!","success"),v.reset(),i.dispatchEvent(new Event("change")),await j()}catch(p){const s=p.message||"Gagal mengirim pengajuan.";u(s,"error")}finally{h=!1}}),B==null||B.addEventListener("click",e=>{e.stopPropagation(),f.classList.toggle("active")}),document.addEventListener("click",()=>f==null?void 0:f.classList.remove("active")),J(),A&&d&&D&&C){const e=()=>{d.classList.remove("hidden"),setTimeout(()=>{d.classList.add("opacity-100"),D.classList.remove("-translate-x-full")},10)},a=()=>{d.classList.remove("opacity-100"),D.classList.add("-translate-x-full"),setTimeout(()=>d.classList.add("hidden"),300)};A.addEventListener("click",e),C.addEventListener("click",a),d.addEventListener("click",t=>{t.target===d&&a()})}},j=async()=>{L.innerHTML='<tr><td colspan="6" class="px-6 py-4 text-center text-gray-500">Memuat data...</td></tr>',k.innerHTML='<p class="text-gray-500">Memuat info...</p>';try{const e=P.getCurrentUser();if(!e||e.role!=="karyawan"){u("Akses ditolak atau sesi tidak valid.","error"),P.logout();return}const[a,t,n]=await Promise.all([$.getMyLeaveRequests(),$.getLeaveSummary(),K(e.id,e.name||"User")]);I&&(I.src=n,I.alt=e.name||"User Avatar"),q(t),o=Array.isArray(a)?a.sort((g,p)=>new Date(p.created_at)-new Date(g.created_at)):[],r=1,M(o,r,m),_(o.length,r,m)}catch(e){console.error("Error initializing page:",e),u(e.message||"Gagal memuat data halaman.","error"),L.innerHTML=`<tr><td colspan="6" class="px-6 py-4 text-center text-red-500">Gagal memuat data: ${e.message}</td></tr>`,(e.status===401||e.status===403)&&P.logout()}};z(),j(),i.dispatchEvent(new Event("change"))});
