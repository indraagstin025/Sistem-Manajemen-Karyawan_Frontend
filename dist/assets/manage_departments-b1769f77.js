import"./input-214ac174.js";import{d as y}from"./DepartemenServices-5d2df75f.js";import{a as k}from"./AuthServices-0f733033.js";import{i as w}from"./sidebarHandler-d6522c99.js";document.addEventListener("DOMContentLoaded",()=>{w();const d=document.getElementById("departmentTableBody"),u=document.getElementById("loadingMessage"),s=document.getElementById("departmentListError"),r=document.getElementById("departmentListSuccess"),L=document.getElementById("paginationInfo"),D=document.getElementById("prevPageBtn"),f=document.getElementById("nextPageBtn");document.getElementById("searchInput");const n=document.getElementById("editDepartmentModal"),B=document.getElementById("closeEditDepartmentModalBtn"),b=document.getElementById("cancelEditDepartmentBtn"),p=document.getElementById("editDepartmentForm"),i=document.getElementById("editDepartmentErrorMessage"),o=document.getElementById("editDepartmentSuccessMessage"),v=document.getElementById("editDepartmentId"),I=document.getElementById("editDepartmentName"),c=(e,t="success")=>{r.classList.add("hidden"),s.classList.add("hidden"),t==="success"?(r.textContent=e,r.classList.remove("hidden")):(s.textContent=e,s.classList.remove("hidden")),setTimeout(()=>{r.classList.add("hidden"),s.classList.add("hidden")},3e3)},g=(e,t="success")=>{i.classList.add("hidden"),o.classList.add("hidden"),t==="success"?(o.textContent=e,o.classList.remove("hidden")):(i.textContent=e,i.classList.remove("hidden"))},l=localStorage.getItem("token");if(!l){c("Anda tidak terautentikasi. Silakan login ulang.","error"),setTimeout(()=>window.location.href="/src/pages/login.html",2e3);return}const h=async()=>{d.innerHTML="",u.classList.remove("hidden");try{const e=await y.getAllDepartments(l);u.classList.add("hidden"),e&&e.length>0?(x(e),L.textContent=`Menampilkan ${e.length} dari ${e.length} departemen`,D.disabled=!0,f.disabled=!0):(d.innerHTML='<tr><td colspan="3" class="text-center py-4 text-gray-500">Tidak ada data departemen.</td></tr>',L.textContent="Menampilkan 0 dari 0 departemen",D.disabled=!0,f.disabled=!0)}catch(e){u.classList.add("hidden");let t="Gagal memuat data departemen.";(e.status===401||e.status===403)&&(t="Sesi Anda berakhir. Silakan login kembali.",setTimeout(()=>k.logout(),2e3)),c(t,"error")}},x=e=>{d.innerHTML="",e.forEach(t=>{const a=document.createElement("tr");a.className="border-b border-gray-100";const E=new Date(t.created_at).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric"});a.innerHTML=`
        <td class="px-4 py-3">${t.name}</td>
        <td class="px-4 py-3">${E}</td>
        <td class="px-4 py-3">
          <button class="edit-btn text-blue-600 hover:text-blue-800 mr-2" title="Edit" data-id="${t.id}" data-name="${t.name}">
            <i data-feather="edit" class="w-5 h-5"></i>
          </button>
          <button class="delete-btn text-red-600 hover:text-red-800" title="Hapus" data-id="${t.id}" data-name="${t.name}">
            <i data-feather="trash-2" class="w-5 h-5"></i>
          </button>
        </td>
      `,d.appendChild(a)}),feather.replace(),document.querySelectorAll(".edit-btn").forEach(t=>{t.addEventListener("click",a=>T(a.currentTarget.dataset.id,a.currentTarget.dataset.name))}),document.querySelectorAll(".delete-btn").forEach(t=>{t.addEventListener("click",a=>S(a.currentTarget.dataset.id,a.currentTarget.dataset.name))})},T=(e,t)=>{i.classList.add("hidden"),o.classList.add("hidden"),v.value=e,I.value=t,n.classList.remove("hidden")},m=()=>{n.classList.add("hidden"),p.reset()},S=async(e,t)=>{if(confirm(`Apakah Anda yakin ingin menghapus departemen "${t}"?`))try{await y.deleteDepartment(e,l),c(`Departemen "${t}" berhasil dihapus!`,"success"),h()}catch(a){c(a.message||"Gagal menghapus departemen.","error")}};B&&B.addEventListener("click",m),b&&b.addEventListener("click",m),n&&n.addEventListener("click",e=>{e.target===n&&m()}),p&&p.addEventListener("submit",async e=>{e.preventDefault();const t=v.value,a=I.value.trim();if(!a){g("Nama departemen tidak boleh kosong.","error");return}try{await y.updateDepartment(t,{name:a},l),g("Departemen berhasil diupdate!","success"),setTimeout(()=>{m(),h()},1500)}catch(E){g(E.message||"Gagal mengupdate departemen.","error")}});const M=document.getElementById("logoutButton");M&&M.addEventListener("click",e=>{e.preventDefault(),k.logout()}),h()});
