import"../input-214ac174.js";import{d as y}from"../DepartemenServices-5d2df75f.js";import{a as E}from"../AuthServices-0f733033.js";import{i as x}from"../sidebarHandler-d6522c99.js";import{i as N}from"../logoutHandler-a2e70173.js";document.addEventListener("DOMContentLoaded",async()=>{x(),N();const u=document.getElementById("addDepartmentForm"),i=document.getElementById("departmentName"),t=document.getElementById("departmentNameError"),o=document.getElementById("departmentErrorMessage"),h=document.getElementById("departmentSuccessMessage"),p=document.getElementById("cancelButton"),d=document.getElementById("submitButton"),g=document.getElementById("submitText"),L=document.getElementById("loadingText");let n=!1;function f(e){const r=e.trim();return r.length>=2&&r.length<=50&&/^[a-zA-Z0-9\s&-]+$/.test(r)}function l(){d.disabled=!n,n?(d.classList.remove("bg-gray-400","cursor-not-allowed"),d.classList.add("bg-teal-600","hover:bg-teal-700")):(d.classList.add("bg-gray-400","cursor-not-allowed"),d.classList.remove("bg-teal-600","hover:bg-teal-700"))}i.addEventListener("blur",function(){const e=this.value.trim();e?f(e)?(n=!0,t.classList.add("hidden"),this.classList.remove("border-red-500")):(n=!1,e.length<2?t.textContent="Nama departemen minimal 2 karakter.":e.length>50?t.textContent="Nama departemen maksimal 50 karakter.":t.textContent="Nama departemen hanya boleh huruf, angka, spasi, &, dan -.",t.classList.remove("hidden"),this.classList.add("border-red-500")):(n=!1,t.textContent="Nama departemen wajib diisi.",t.classList.remove("hidden"),this.classList.add("border-red-500")),l()}),i.addEventListener("input",function(){this.value=this.value.replace(/\s+/g," ");const e=this.value.trim();f(e)?(n=!0,t.classList.add("hidden"),this.classList.remove("border-red-500")):e.length>0?(e.length<2?t.textContent="Nama departemen minimal 2 karakter.":e.length>50?t.textContent="Nama departemen maksimal 50 karakter.":t.textContent="Nama departemen hanya boleh huruf, angka, spasi, &, dan -.",t.classList.remove("hidden"),this.classList.add("border-red-500"),n=!1):(n=!1,t.classList.add("hidden"),this.classList.remove("border-red-500")),l()}),l();const m=(e,r="success",s)=>{s.classList.add("hidden"),s.innerHTML="",r==="success"?(s.innerHTML=e,s.classList.remove("hidden","text-red-600"),s.classList.add("text-green-600")):(s.innerHTML=e,s.classList.remove("hidden","text-green-600"),s.classList.add("text-red-600")),setTimeout(()=>{s.classList.add("hidden"),s.innerHTML=""},5e3)};if(!u){console.error('Formulir tambah departemen tidak ditemukan. Pastikan ID "addDepartmentForm" benar.');return}u.addEventListener("submit",async e=>{if(e.preventDefault(),i.dispatchEvent(new Event("blur")),!n){m("Harap perbaiki kesalahan pada form sebelum melanjutkan.","error",o),i.focus();return}o.classList.add("hidden"),h.classList.add("hidden"),o.textContent="",h.textContent="";const r=i.value.trim(),s=["HR","IT","Finance","Marketing","Sales","Operations","Admin"],v=r.toLowerCase();if(s.some(a=>a.toLowerCase()===v)){m("Departemen ini mungkin sudah ada. Silakan gunakan nama yang lebih spesifik.","error",o);return}const b=localStorage.getItem("token");if(!b){m("Anda tidak terautentikasi. Silakan login ulang.","error",o),E.logout();return}d.disabled=!0,g.classList.add("hidden"),L.classList.remove("hidden"),d.classList.add("bg-gray-400","cursor-not-allowed");try{const a=await y.createDepartment({name:r},b);console.log("Departemen berhasil ditambahkan:",a),m("Departemen berhasil ditambahkan!","success",h),u.reset(),n=!1,i.classList.remove("border-red-500"),t.classList.add("hidden"),setTimeout(()=>{window.location.href="/src/pages/Admin/manage_departments.html"},2e3)}catch(a){console.error("Gagal menambahkan departemen:",a);let c="Terjadi kesalahan saat menambahkan departemen. Silakan coba lagi.";a.details?Array.isArray(a.details)?c=a.details.map(k=>`${k.Field||"Error"}: ${k.Msg}`).join("<br>"):typeof a.details=="string"?c=a.details:a.details.error&&(c=a.details.error):a.message&&(c=a.message),m(c,"error",o)}finally{d.disabled=!1,g.classList.remove("hidden"),L.classList.add("hidden"),l()}}),p&&p.addEventListener("click",()=>{confirm("Apakah Anda yakin ingin membatalkan? Data yang sudah diisi akan hilang.")&&(u.reset(),n=!1,l(),t.classList.add("hidden"),o.classList.add("hidden"),i.classList.remove("border-red-500"),h.classList.add("hidden"),window.location.href="/src/pages/Admin/admin_dashboard.html")})});
