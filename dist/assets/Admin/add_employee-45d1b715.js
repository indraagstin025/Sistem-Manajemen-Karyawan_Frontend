import"../input-214ac174.js";import{u as E}from"../UserServices-eeba983d.js";import{d as b}from"../DepartemenServices-90f4b5b0.js";import{a as f}from"../AuthServices-170aab02.js";import{i as w}from"../sidebarHandler-d6522c99.js";import{T as L}from"../toastify-85d374dd.js";let r={name:!1,email:!1,password:!1,position:!1,department:!1,salary:!1};function c(){const t=document.getElementById("submitButton");if(!t)return;const o=Object.values(r).every(i=>i);t.disabled=!o,o?(t.classList.remove("bg-gray-400","cursor-not-allowed"),t.classList.add("bg-teal-600","hover:bg-teal-700")):(t.classList.add("bg-gray-400","cursor-not-allowed"),t.classList.remove("bg-teal-600","hover:bg-teal-700"))}function k(t){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)}function B(t){return t.trim().length>=2&&/^[a-zA-Z\s]+$/.test(t.trim())}function y(){const t=document.getElementById("name"),o=document.getElementById("email"),i=document.getElementById("password"),m=document.getElementById("position"),d=document.getElementById("department"),l=document.getElementById("base_salary");t==null||t.addEventListener("input",function(){const e=document.getElementById("nameError");B(this.value)?(r.name=!0,e.classList.add("hidden")):(r.name=!1,e.textContent="Nama harus minimal 2 karakter dan hanya huruf.",e.classList.remove("hidden")),c()}),o==null||o.addEventListener("input",function(){const e=document.getElementById("emailError");k(this.value)?(r.email=!0,e.classList.add("hidden")):(r.email=!1,e.textContent="Format email tidak valid.",e.classList.remove("hidden")),c()}),i==null||i.addEventListener("input",function(){const e=document.getElementById("passwordError");this.value.length<6?(r.password=!1,e.textContent="Password minimal 8 karakter dan harus menggunakan Campuran Huruf Besar.",e.classList.remove("hidden")):(r.password=!0,e.classList.add("hidden")),c()}),m==null||m.addEventListener("input",function(){const e=document.getElementById("positionError");this.value.trim().length<2?(r.position=!1,e.textContent="Posisi wajib diisi.",e.classList.remove("hidden")):(r.position=!0,e.classList.add("hidden")),c()}),d==null||d.addEventListener("change",function(){const e=document.getElementById("departmentError");this.value?(r.department=!0,e.classList.add("hidden")):(r.department=!1,e.textContent="Departemen wajib dipilih.",e.classList.remove("hidden")),c()}),l==null||l.addEventListener("input",function(){const e=document.getElementById("salaryError"),g=parseFloat(this.value);isNaN(g)||g<1?(r.salary=!1,e.textContent="Gaji harus angka positif.",e.classList.remove("hidden")):(r.salary=!0,e.classList.add("hidden")),c()}),c()}function x(){return Object.values(r).every(t=>t)}document.addEventListener("DOMContentLoaded",async()=>{w(),y();const t=document.getElementById("addEmployeeForm"),o=document.getElementById("department"),i=document.getElementById("cancelButton"),m=document.querySelectorAll("#logoutButton"),d=document.getElementById("password"),l=document.getElementById("togglePassword");l&&d&&l.addEventListener("click",()=>{const a=d.getAttribute("type")==="password"?"text":"password";d.setAttribute("type",a);const n=l.querySelector("i");a==="password"?n.setAttribute("data-feather","eye-off"):n.setAttribute("data-feather","eye"),feather.replace()});function e(a,n="success"){const s={success:"linear-gradient(to right, #10b981, #14b8a6)",error:"linear-gradient(to right, #ef4444, #dc2626)",warning:"linear-gradient(to right, #f97316, #ea580c)"},u=s[n]||s.error;L({text:a,duration:n==="success"?3e3:-1,close:!0,gravity:"top",position:"center",stopOnFocus:!0,style:{background:u,borderRadius:"8px",padding:"20px 24px",boxShadow:"0 5px 15px rgba(0,0,0,0.3)",maxWidth:"400px",textAlign:"center"},modal:!0}).showToast()}await(async()=>{try{const a=await b.getAllDepartments();o.innerHTML='<option value="">Pilih Departemen</option>',a.forEach(n=>{const s=document.createElement("option");s.value=n.name,s.textContent=n.name,o.appendChild(s)})}catch(a){console.error("Gagal memuat daftar departemen:",a),e("Gagal memuat daftar departemen.","error"),a.status===401&&f.logout()}})(),t.addEventListener("submit",async a=>{var h;if(a.preventDefault(),!x()){e("Harap perbaiki semua kesalahan pada form.","error");return}const n=new FormData(t),s=Object.fromEntries(n.entries());s.role="karyawan",s.base_salary=parseFloat(s.base_salary);const u=localStorage.getItem("token");if(!u){f.logout();return}try{await E.registerUser(s,u),e("Karyawan baru berhasil didaftarkan!","success"),t.reset(),y(),setTimeout(()=>{window.location.href="/src/pages/Admin/manage_employees.html"},2e3)}catch(p){console.error("Gagal mendaftarkan karyawan:",p);const v=((h=p.details)==null?void 0:h.error)||p.message||"Terjadi kesalahan server.";e(v,"error")}}),i==null||i.addEventListener("click",()=>{confirm("Anda yakin ingin membatalkan? Perubahan tidak akan disimpan.")&&(window.location.href="/src/pages/Admin/manage_employees.html")}),m.forEach(a=>{a==null||a.addEventListener("click",n=>{n.preventDefault(),f.logout()})})});
