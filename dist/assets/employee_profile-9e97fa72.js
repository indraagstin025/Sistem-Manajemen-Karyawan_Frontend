import"./input-795bf19b.js";import{u}from"./UserServices-9109671c.js";import{a as c}from"./AuthServices-0f733033.js";import{T as U}from"./toastify-3acd0462.js";/* empty css                 */import{i as _}from"./darkmode-c57850a7.js";const A=(d,n,m)=>!d||!n||!m?{isValid:!1,message:"Semua kolom password wajib diisi."}:n!==m?{isValid:!1,message:"Password baru dan konfirmasi tidak cocok."}:n.length<8?{isValid:!1,message:"Password baru minimal 8 karakter."}:/[A-Z]/.test(n)?{isValid:!0,message:"Validasi berhasil."}:{isValid:!1,message:"Password baru harus mengandung setidaknya satu huruf kapital."};document.addEventListener("DOMContentLoaded",()=>{feather.replace(),_();const d=document.getElementById("profilePhotoPreview"),n=document.getElementById("photoUpload"),m=document.getElementById("name"),f=document.getElementById("email"),B=document.getElementById("position"),S=document.getElementById("department"),g=document.getElementById("address"),p=document.getElementById("profileForm"),h=document.getElementById("changePasswordFormProfile"),y=document.getElementById("showPasswordCheckbox"),L=document.querySelectorAll("#logoutButton, #dropdownLogoutButton, #mobileLogoutButton"),v=document.getElementById("cancelProfileEditBtn"),l=document.getElementById("base_salary"),P=document.getElementById("toggleSalaryVisibility"),E=document.getElementById("salaryEyeIcon");let k="",b={};const o=(t,a="success")=>{let e;a==="success"?e="linear-gradient(to right, #22c55e, #16a34a)":a==="error"?e="linear-gradient(to right, #ef4444, #dc2626)":e="linear-gradient(to right, #3b82f6, #2563eb)",U({text:t,duration:3e3,close:!0,gravity:"top",position:"right",stopOnFocus:!0,style:{background:e,borderRadius:"8px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",padding:"12px 20px"}}).showToast()},I=async()=>{try{const t=localStorage.getItem("user");if(!t)throw new Error("Sesi tidak valid. Harap login kembali.");const a=JSON.parse(t),e=await u.getUserByID(a.id);if(e){m.value=e.name||"",f.value=e.email||"",B.value=e.position||"",S.value=e.department||"",k=e.base_salary,l&&(l.value="••••••••••",l.dataset.masked="true",E.setAttribute("data-feather","eye"),feather.replace()),g.value=e.address||"",b={email:e.email||"",address:e.address||""};const s=document.getElementById("userAvatar");s&&(s.src=e.photo_url||"https://placehold.co/40x40/E2E8F0/4A5568?text=ME");try{const r=await u.getProfilePhoto(a.id),i=URL.createObjectURL(r);d.src=i}catch{d.src="https://placehold.co/128x128/E2E8F0/4A5568?text=ME"}}}catch(t){console.error("Error loading profile data:",t),o(t.message||"Gagal memuat data profil. Silakan coba lagi.","error"),(t.message.includes("Sesi")||t.status===401||t.status===403)&&setTimeout(()=>c.logout(),2e3)}},x=t=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(t);p&&p.addEventListener("submit",async t=>{t.preventDefault();const a=localStorage.getItem("user");try{if(!a)throw new Error("Sesi tidak valid. Harap login kembali.");const e=JSON.parse(a),s=n.files[0],r={};if(f.value.trim()!==b.email&&(r.email=f.value.trim()),g.value.trim()!==b.address&&(r.address=g.value.trim()),Object.keys(r).length===0&&!s)return o("Tidak ada perubahan untuk disimpan.","info");if(Object.keys(r).length>0){await u.updateUser(e.id,r);const i=c.getCurrentUser();i&&r.email&&(i.email=r.email,localStorage.setItem("user",JSON.stringify(i)))}if(s){if(s.size>5*1024*1024){o("Ukuran file maksimal adalah 5MB.","error");return}const D=await u.uploadProfilePhoto(e.id,s),F=await u.getProfilePhoto(e.id);d.src=URL.createObjectURL(F);const w=c.getCurrentUser();w&&(w.photo_url=D.photo_url,localStorage.setItem("user",JSON.stringify(w)))}o("Profil berhasil diupdate!","success"),I()}catch(e){console.error("Error updating profile:",e),o(e.message||"Gagal mengupdate profil.","error"),(e.status===401||e.status===403)&&setTimeout(()=>c.logout(),2e3)}}),v&&v.addEventListener("click",t=>{t.preventDefault(),p.reset(),I(),o("Perubahan dibatalkan.","info")}),P&&P.addEventListener("click",()=>{l.dataset.masked==="true"?(l.value=x(k),l.dataset.masked="false",E.setAttribute("data-feather","eye-off")):(l.value="••••••••••",l.dataset.masked="true",E.setAttribute("data-feather","eye")),feather.replace()}),h&&h.addEventListener("submit",async t=>{t.preventDefault();const a=document.getElementById("oldPasswordProfile").value,e=document.getElementById("newPasswordProfile").value,s=document.getElementById("confirmNewPasswordProfile").value,r=A(a,e,s);if(!r.isValid)return o(r.message,"error");try{await c.changePassword(a,e),o("Password berhasil diubah!","success"),h.reset()}catch(i){console.error("Error changing password:",i),o(i.message||"Gagal mengubah password.","error")}}),y&&y.addEventListener("change",()=>{const t=y.checked;[document.getElementById("oldPasswordProfile"),document.getElementById("newPasswordProfile"),document.getElementById("confirmNewPasswordProfile")].forEach(e=>{e&&(e.type=t?"text":"password")})}),n&&n.addEventListener("change",function(){if(this.files&&this.files[0]){const t=new FileReader;t.onload=a=>{d.src=a.target.result},t.readAsDataURL(this.files[0])}}),L.forEach(t=>{t.addEventListener("click",a=>{a.preventDefault(),c.logout()})}),I()});
