import"./input-ac4e21e1.js";import{d as x}from"./DepartemenServices-5d2df75f.js";import{a as E}from"./AuthServices-0f733033.js";import{i as Q}from"./sidebarHandler-d6522c99.js";import{i as R,S as c}from"./logoutHandler-a2e70173.js";import{Q as b}from"./qrCodeHandler-3c60f548.js";import{T as U}from"./toastify-3acd0462.js";import"./AttendanceServices-9bf2f837.js";document.addEventListener("DOMContentLoaded",async()=>{feather.replace(),Q(),R({preLogoutCallback:()=>{typeof b<"u"&&b.close&&b.close()}}),b.initialize({toastCallback:(e,a)=>{let r;a==="success"?r="linear-gradient(to right, #22c55e, #16a34a)":a==="error"?r="linear-gradient(to right, #ef4444, #dc2626)":r="linear-gradient(to right, #3b82f6, #2563eb)",U({text:e,duration:3e3,close:!0,gravity:"top",position:"right",style:{background:r,borderRadius:"8px"}}).showToast()}});const g=document.getElementById("departmentTableBody"),B=document.getElementById("loadingMessage"),$=document.getElementById("departmentListError"),G=document.getElementById("departmentListSuccess"),T=document.getElementById("paginationInfo"),p=document.getElementById("prevPageBtn"),f=document.getElementById("nextPageBtn"),v=document.getElementById("searchInput"),d=document.getElementById("editDepartmentModal"),I=document.getElementById("closeEditDepartmentModalBtn"),M=document.getElementById("cancelEditDepartmentBtn"),D=document.getElementById("editDepartmentForm"),w=document.getElementById("editDepartmentErrorMessage"),C=document.getElementById("editDepartmentSuccessMessage"),S=document.getElementById("editDepartmentId"),A=document.getElementById("editDepartmentName"),o=document.getElementById("userAvatar");document.getElementById("userDropdown"),document.getElementById("dropdownMenu");let i=1;const l=10;let L=[],m=[],P="";const h=(e,a,r="success",t=!1,n=2e3)=>{c.fire({title:e,html:a,icon:r,showConfirmButton:t,timer:n,timerProgressBar:!0,didOpen:s=>{n>0&&(s.addEventListener("mouseenter",c.stopTimer),s.addEventListener("mouseleave",c.resumeTimer))}})},H=async()=>{try{const e=await E.getCurrentUser();e&&e.photo_url&&o?o.src=e.photo_url:o&&(o.src="/assets/default-avatar.png")}catch(e){console.error("Gagal memuat profil pengguna:",e),o&&(o.src="/assets/default-avatar.png")}},k=async()=>{g.innerHTML="",B.classList.remove("hidden"),$.classList.add("hidden"),G.classList.add("hidden");try{const e=await x.getAllDepartments();B.classList.add("hidden"),Array.isArray(e)?L=e.sort((a,r)=>new Date(r.created_at)-new Date(a.created_at)):(console.warn("Peringatan: API tidak mengembalikan array departemen. Menerima:",e),L=[]),u()}catch(e){B.classList.add("hidden");let a="Gagal memuat data departemen.";e.status===401||e.status===403?(a="Sesi Anda berakhir atau Anda tidak memiliki izin. Silakan login kembali.",setTimeout(()=>E.logout(),2e3)):e.message&&(a=e.message),h("Error Data",a,"error",!0)}},u=()=>{m=L.filter(e=>e.name.toLowerCase().includes(P.toLowerCase())),m.length===0?(g.innerHTML='<tr><td colspan="3" class="text-center py-4 text-gray-500">Tidak ada data departemen yang ditemukan.</td></tr>',T.textContent="Menampilkan 0 dari 0 departemen",p.disabled=!0,f.disabled=!0):(z(m),N(m.length))},z=e=>{g.innerHTML="";const a=(i-1)*l,r=a+l,t=e.slice(a,r);if(t.length===0&&i>1){i--,u();return}t.forEach(n=>{const s=document.createElement("tr");s.className="border-b border-gray-100 hover:bg-gray-50";const O=new Date(n.created_at).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric"});s.innerHTML=`
                <td class="px-4 py-3 text-sm font-medium text-gray-900">${n.name}</td>
                <td class="px-4 py-3 text-sm text-gray-700">${O}</td>
                <td class="px-4 py-3 text-sm flex items-center space-x-2">
                    <button class="edit-btn text-blue-600 hover:text-blue-800 transition-colors duration-200 p-1 rounded-md hover:bg-blue-50" title="Edit" data-id="${n.id}" data-name="${n.name}">
                        <i data-feather="edit" class="w-5 h-5"></i>
                    </button>
                    <button class="delete-btn text-red-600 hover:text-red-800 transition-colors duration-200 p-1 rounded-md hover:bg-red-50" title="Hapus" data-id="${n.id}" data-name="${n.name}">
                        <i data-feather="trash-2" class="w-5 h-5"></i>
                    </button>
                </td>
            `,g.appendChild(s)}),feather.replace(),document.querySelectorAll(".edit-btn").forEach(n=>{n.addEventListener("click",s=>_(s.currentTarget.dataset.id,s.currentTarget.dataset.name))}),document.querySelectorAll(".delete-btn").forEach(n=>{n.addEventListener("click",s=>j(s.currentTarget.dataset.id,s.currentTarget.dataset.name))})},N=e=>{const a=Math.ceil(e/l),r=(i-1)*l+1,t=Math.min(i*l,e);T.textContent=`Menampilkan ${r}-${t} dari ${e} departemen`,p.disabled=i===1,f.disabled=i>=a},_=(e,a)=>{w.classList.add("hidden"),C.classList.add("hidden"),S.value=e,A.value=a,d.classList.remove("hidden"),setTimeout(()=>d.classList.add("active"),10)},y=()=>{d.classList.remove("active"),setTimeout(()=>{d.classList.add("hidden"),D.reset()},300)};I&&I.addEventListener("click",y),M&&M.addEventListener("click",y),d&&d.addEventListener("click",e=>{e.target===d&&y()});const j=async(e,a)=>{c.fire({title:`Hapus ${a}?`,text:"Tindakan ini tidak dapat dibatalkan! Departemen ini akan dihapus secara permanen.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Ya, hapus!",cancelButtonText:"Batal"}).then(async r=>{if(r.isConfirmed)try{await x.deleteDepartment(e),c.fire({title:"Terhapus!",text:`Departemen "${a}" berhasil dihapus.`,icon:"success",timer:2e3,showConfirmButton:!1}),k()}catch(t){console.error("Gagal menghapus departemen:",t);let n="Terjadi kesalahan saat menghapus departemen. Silakan coba lagi.";t.status===401||t.status===403?(n="Anda tidak memiliki izin untuk menghapus departemen ini.",setTimeout(()=>E.logout(),2e3)):t.message&&(n=t.message),c.fire({title:"Gagal",text:n,icon:"error",confirmButtonText:"OK"})}})};if(D&&D.addEventListener("submit",async e=>{e.preventDefault(),w.classList.add("hidden"),C.classList.add("hidden");const a=S.value,r=A.value.trim();if(!r){h("Validasi Gagal","Nama departemen tidak boleh kosong.","error");return}try{await x.updateDepartment(a,{name:r}),h("Berhasil!","Departemen berhasil diupdate!","success",!1,1500),setTimeout(()=>{y(),k()},1500)}catch(t){console.error("Gagal mengupdate departemen:",t);let n="Terjadi kesalahan saat mengupdate departemen. Silakan coba lagi.";t.details?Array.isArray(t.details)?n=t.details.map(s=>`${s.Field||"Error"}: ${s.Msg}`).join("<br>"):typeof t.details=="string"&&(n=t.details):t.message&&(n=t.message),h("Gagal Update",n,"error",!0),(t.status===401||t.status===403)&&setTimeout(()=>E.logout(),2e3)}}),p&&p.addEventListener("click",()=>{i>1&&(i--,u())}),f&&f.addEventListener("click",()=>{const e=Math.ceil(m.length/l);i<e&&(i++,u())}),v){let e;v.addEventListener("input",()=>{clearTimeout(e),e=setTimeout(()=>{P=v.value,i=1,u()},500)})}H(),k()});
