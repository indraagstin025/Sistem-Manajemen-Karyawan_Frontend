import{A as f}from"./AttendanceServices-812a17ce.js";let c,s,r=!1,l;const E=a=>{const e=document.getElementById("modal-qr-expires-at");s&&clearInterval(s);const o=()=>{if(!e)return;const t=new Date,n=a.getTime()-t.getTime();if(n<=0){clearInterval(s),e.textContent="Kedaluwarsa, menunggu refresh...";return}const d=Math.floor(n/1e3);e.textContent=`Refresh otomatis dalam: ${d} detik`};o(),s=setInterval(o,1e3)},h=a=>{const e=document.getElementById("modal-qr-code-image"),o=document.getElementById("modal-qr-placeholder");if(!e||!o)return;const t=()=>{o.classList.add("hidden"),e.src=a.qr_code_image,e.classList.remove("hidden","opacity-0","scale-95")};e.src&&!e.classList.contains("hidden")?(e.classList.add("opacity-0","scale-95"),setTimeout(t,300)):t()},u=async(a=!1)=>{var o;const e=document.getElementById("modal-qr-placeholder");if(r){console.warn("Proses generate QR sudah berjalan.");return}r=!0,c&&clearTimeout(c),a||e&&(e.textContent="Membuat QR Code...",e.classList.remove("hidden"),(o=document.getElementById("modal-qr-code-image"))==null||o.classList.add("hidden"));try{const t=await f.generateQR();h(t),E(new Date(t.expires_at));const n=new Date(t.expires_at),d=new Date,m=n.getTime()-d.getTime()-5e3;c=setTimeout(()=>{u(!0)},Math.max(m,1e3)),!a&&l&&l("QR Code berhasil dibuat!","success")}catch(t){console.error("Gagal men-generate QR Code:",t),l&&l(t.message||"Gagal membuat QR Code.","error"),e&&(e.textContent="Gagal membuat QR. Coba lagi.")}finally{r=!1}},g=()=>{const a=document.getElementById("qrCodeModal");a&&(a.classList.remove("hidden"),setTimeout(()=>a.classList.add("active"),10),u(!1))},i=()=>{const a=document.getElementById("qrCodeModal");a&&(a.classList.remove("active"),setTimeout(()=>a.classList.add("hidden"),300)),c&&clearTimeout(c),s&&clearInterval(s),r=!1;const e=document.getElementById("modal-qr-code-image");e&&(e.src="",e.classList.add("hidden","opacity-0","scale-95"));const o=document.getElementById("modal-qr-placeholder");o&&(o.classList.remove("hidden"),o.textContent="Memuat QR Code...");const t=document.getElementById("modal-qr-expires-at");t&&(t.textContent="")};function C(a){l=a.toastCallback;const e=document.getElementById("generate-qr-menu-btn"),o=document.getElementById("generate-qr-menu-btn-mobile"),t=document.getElementById("modal-generate-qr-btn"),n=document.getElementById("closeModalBtn"),d=document.getElementById("qrCodeModal");e==null||e.addEventListener("click",g),o==null||o.addEventListener("click",g),t==null||t.addEventListener("click",()=>u(!1)),n==null||n.addEventListener("click",i),d==null||d.addEventListener("click",m=>{m.target===d&&i()}),window.addEventListener("beforeunload",i)}const I={initialize:C,close:i};export{I as Q};
