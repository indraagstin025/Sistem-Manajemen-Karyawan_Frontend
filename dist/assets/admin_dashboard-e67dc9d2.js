import"./input-ef370086.js";import{a as E,d as C}from"./AuthServices-f47c4eb9.js";import{u as L,g as p}from"./photoUtils-240b8068.js";import{Q as u}from"./qrCodeHandler-01879f51.js";import{i as I}from"./logoutHandler-87b1a96c.js";import{T as w}from"./toastify-3acd0462.js";/* empty css                 */import"./AttendanceServices-f61bdc29.js";document.addEventListener("DOMContentLoaded",()=>{feather.replace();const g=document.getElementById("sidebarToggle"),d=document.getElementById("mobileSidebar"),c=document.getElementById("mobileSidebarPanel"),f=document.getElementById("closeSidebar");g&&d&&c&&f&&(g.addEventListener("click",()=>{d.classList.remove("hidden"),setTimeout(()=>{d.classList.add("opacity-100"),c.classList.remove("-translate-x-full")},10)}),f.addEventListener("click",()=>{c.classList.add("-translate-x-full"),d.classList.remove("opacity-100"),setTimeout(()=>{d.classList.add("hidden")},300)}),d.addEventListener("click",a=>{a.target===d&&(c.classList.add("-translate-x-full"),d.classList.remove("opacity-100"),setTimeout(()=>{d.classList.add("hidden")},300))}));const m=(a,e="success")=>{const n={success:"linear-gradient(to right, #22c55e, #16a34a)",error:"linear-gradient(to right, #ef4444, #dc2626)",info:"linear-gradient(to right, #3b82f6, #2563eb)"}[e];w({text:a,duration:3e3,close:!0,gravity:"top",position:"right",style:{background:n,borderRadius:"8px"}}).showToast()},b=async()=>{const a=document.getElementById("userAvatar"),e=document.getElementById("adminProfilePhoto"),n=document.getElementById("adminName"),o=document.getElementById("adminRole"),r=document.getElementById("adminEmail");try{const i=E.getCurrentUser();if(!i||!i.id){a&&(a.src="/assets/default-avatar.png"),e&&(e.src="/assets/default-avatar.png"),n&&(n.textContent="Guest"),o&&(o.textContent="N/A"),r&&(r.textContent="N/A");return}const t=await L.getUserByID(i.id);if(t){const s=t._id||t.id,l=t.name||"Admin",v=await p(s,l,40);a&&(a.src=v||"/assets/default-avatar.png",a.alt=l);const x=await p(s,l,96);e&&(e.src=x||"/assets/default-avatar.png",e.alt=l+" Photo"),n&&(n.textContent=t.name||"Admin"),o&&(o.textContent=t.role||"Administrator"),r&&(r.textContent=t.email||"admin@hrsystem.com")}else a&&(a.src="/assets/default-avatar.png"),e&&(e.src="/assets/default-avatar.png"),n&&(n.textContent="Guest"),o&&(o.textContent="N/A"),r&&(r.textContent="N/A"),m("Data profil admin tidak ditemukan.","error")}catch(i){console.error("DEBUG: Gagal memuat profil pengguna:",i),a&&(a.src="/assets/default-avatar.png"),e&&(e.src="/assets/default-avatar.png"),n&&(n.textContent="Error"),o&&(o.textContent="Error"),r&&(r.textContent="Error"),m("Gagal memuat data profil pengguna.","error")}},h=async()=>{const a=document.getElementById("totalKaryawan"),e=document.getElementById("karyawanAktif"),n=document.getElementById("totalDepartemen"),o=document.getElementById("pendingLeavesCount"),r=document.getElementById("latestActivitiesList"),i=document.getElementById("departmentChart");try{const t=await C.getDashboardStats();if(a&&(a.innerText=t.total_karyawan||0),e&&(e.innerText=t.karyawan_aktif||0),n&&(n.innerText=t.total_departemen||0),o&&(o.innerText=t.pending_leave_requests_count||0),r&&t.aktivitas_terbaru?(r.innerHTML="",t.aktivitas_terbaru.length>0?t.aktivitas_terbaru.forEach(s=>{const l=document.createElement("li");l.className="flex items-center text-sm text-gray-700 py-2",l.innerHTML=`<i data-feather="activity" class="w-4 h-4 mr-2 text-blue-500"></i><span>${s}</span>`,r.appendChild(l)}):r.innerHTML=`
                        <li class="flex items-center text-sm text-gray-700 py-2">
                            <i data-feather="info" class="w-4 h-4 mr-2 text-gray-400"></i>
                            <span>Belum ada aktivitas terbaru.</span>
                        </li>
                    `,feather.replace()):r&&(r.innerHTML=`
                    <li class="flex items-center text-sm text-gray-700 py-2">
                        <i data-feather="info" class="w-4 h-4 mr-2 text-gray-400"></i>
                        <span>Belum ada aktivitas terbaru.</span>
                    </li>
                `,feather.replace()),i&&t.distribusi_departemen&&t.distribusi_departemen.length>0)window.myDepartmentChart&&window.myDepartmentChart.destroy(),window.myDepartmentChart=new Chart(i,{type:"bar",data:{labels:t.distribusi_departemen.map(s=>s.department),datasets:[{label:"Jumlah Karyawan",data:t.distribusi_departemen.map(s=>s.count),backgroundColor:["rgba(20, 184, 166, 0.8)","rgba(59, 130, 246, 0.8)","rgba(249, 115, 22, 0.8)","rgba(139, 92, 246, 0.8)","rgba(239, 68, 68, 0.8)","rgba(16, 185, 129, 0.8)","rgba(234, 179, 8, 0.8)"],borderColor:["#0d9488","#2563eb","#d97706","#7c3aed","#b91c1c","#059669","#a16207"],borderWidth:1,borderRadius:4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,ticks:{stepSize:1}}}}});else if(i){const s=i.getContext("2d");s.clearRect(0,0,i.width,i.height),s.font="16px Inter",s.fillStyle="#6b7280",s.textAlign="center",s.fillText("Tidak ada data departemen untuk ditampilkan.",i.width/2,i.height/2)}}catch(t){console.error("Gagal memuat data dashboard:",t),m("Gagal memuat data dashboard.","error")}},y=()=>{const a=document.getElementById("userDropdown"),e=document.getElementById("dropdownMenu");a&&e&&(a.addEventListener("click",n=>{n.stopPropagation(),e.classList.toggle("active"),e.classList.contains("active")?e.classList.remove("hidden"):setTimeout(()=>{e.classList.add("hidden")},200)}),document.addEventListener("click",n=>{e&&!a.contains(n.target)&&!e.contains(n.target)&&(e.classList.remove("active"),setTimeout(()=>{e.classList.add("hidden")},200))})),I({preLogoutCallback:()=>{u.close&&u.close()}}),u.initialize({qrModalId:"qrCodeModal",closeModalBtnId:"closeModalBtn",modalQrCodeImageId:"modal-qr-code-image",modalQrPlaceholderId:"modal-qr-placeholder",modalQrExpiresAtId:"modal-qr-expires-at",modalGenerateQrBtnId:"modal-generate-qr-btn",modalCloseQrBtnId:"modal-close-qr-btn",generateQrMenuBtnId:"generate-qr-menu-btn",generateQrMenuBtnMobileId:"generate-qr-menu-btn-mobile",toastCallback:m})};(()=>{b(),h(),y()})()});
