import"./input-cba40e84.js";import{a as b,d as h}from"./AuthServices-0f733033.js";import{Q as u}from"./qrCodeHandler-3c60f548.js";import{i as y}from"./logoutHandler-a2e70173.js";import{g as w}from"./photoUtils-c92e179b.js";import{T as v}from"./toastify-3acd0462.js";/* empty css                 */import"./AttendanceServices-9bf2f837.js";import"./UserServices-9109671c.js";document.addEventListener("DOMContentLoaded",()=>{feather.replace();const s=(a,t="success")=>{const e={success:"linear-gradient(to right, #22c55e, #16a34a)",error:"linear-gradient(to right, #ef4444, #dc2626)",info:"linear-gradient(to right, #3b82f6, #2563eb)"}[t];v({text:a,duration:3e3,close:!0,gravity:"top",position:"right",style:{background:e,borderRadius:"8px"}}).showToast()},g=async()=>{const a=document.getElementById("userAvatar"),t=document.getElementById("userNameNav");try{const e=await b.getCurrentUser();if(e){const o=await w(e.id,e.name,40);a&&(a.src=o,a.alt=e.name||"Admin"),t&&(t.textContent=e.name||"Admin")}else a&&(a.src="/assets/default-avatar.png"),t&&(t.textContent="Guest")}catch(e){console.error("Gagal memuat profil pengguna:",e),a&&(a.src="/assets/default-avatar.png"),t&&(t.textContent="Error"),s("Gagal memuat data profil pengguna.","error")}},p=async()=>{const a=document.getElementById("totalKaryawan"),t=document.getElementById("karyawanAktif"),e=document.getElementById("totalDepartemen"),o=document.getElementById("karyawanCuti"),l=document.getElementById("pendingLeavesCount"),m=document.getElementById("posisiBaru"),d=document.getElementById("latestActivitiesList"),i=document.getElementById("departmentChart");try{const n=await h.getDashboardStats();if(a&&(a.innerText=n.total_karyawan||0),t&&(t.innerText=n.karyawan_aktif||0),o&&(o.innerText=n.karyawan_cuti||0),l&&(l.innerText=n.pending_leave_requests_count||0),m&&(m.innerText=n.posisi_baru||0),e&&(e.innerText=n.total_departemen||0),d&&n.aktivitas_terbaru&&(d.innerHTML="",n.aktivitas_terbaru.forEach(r=>{const c=document.createElement("li");c.className="flex items-center text-sm text-gray-700 mb-2",c.innerHTML=`<i data-feather="activity" class="w-4 h-4 mr-2 text-blue-500"></i><span>${r}</span>`,d.appendChild(c)}),feather.replace()),i&&n.distribusi_departemen&&n.distribusi_departemen.length>0)window.myDepartmentChart&&window.myDepartmentChart.destroy(),window.myDepartmentChart=new Chart(i,{type:"bar",data:{labels:n.distribusi_departemen.map(r=>r.department),datasets:[{label:"Jumlah Karyawan",data:n.distribusi_departemen.map(r=>r.count),backgroundColor:["rgba(20, 184, 166, 0.8)","rgba(59, 130, 246, 0.8)","rgba(249, 115, 22, 0.8)","rgba(139, 92, 246, 0.8)","rgba(239, 68, 68, 0.8)","rgba(16, 185, 129, 0.8)","rgba(234, 179, 8, 0.8)"],borderColor:["#0d9488","#2563eb","#d97706","#7c3aed","#b91c1c","#059669","#a16207"],borderWidth:1,borderRadius:4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,ticks:{stepSize:1}}}}});else if(i){const r=i.getContext("2d");r.clearRect(0,0,i.width,i.height),r.font="16px Inter",r.fillStyle="#6b7280",r.textAlign="center",r.fillText("Tidak ada data departemen untuk ditampilkan.",i.width/2,i.height/2)}}catch(n){console.error("Gagal memuat data dashboard:",n),s("Gagal memuat data dashboard.","error")}},f=()=>{const a=document.getElementById("userDropdown"),t=document.getElementById("dropdownMenu");a&&t&&(a.addEventListener("click",e=>{e.stopPropagation(),t.classList.toggle("active"),t.classList.contains("active")?t.classList.remove("hidden"):setTimeout(()=>{t.classList.add("hidden")},200)}),document.addEventListener("click",e=>{t&&!a.contains(e.target)&&!t.contains(e.target)&&(t.classList.remove("active"),setTimeout(()=>{t.classList.add("hidden")},200))})),u.initialize({toastCallback:s}),y({preLogoutCallback:u.close})};(()=>{f(),p(),g()})()});
