import"./input-795bf19b.js";import{u as B}from"./UserServices-9109671c.js";import{d as Y}from"./DepartemenServices-5d2df75f.js";import{a as m}from"./AuthServices-0f733033.js";import{i as J}from"./sidebarHandler-d6522c99.js";import{i as V,S as u}from"./logoutHandler-a2e70173.js";import{Q as x}from"./qrCodeHandler-3c60f548.js";import{g as W}from"./photoUtils-c92e179b.js";import{i as X}from"./darkmode-c57850a7.js";import{T as Z}from"./toastify-3acd0462.js";/* empty css                 */import"./AttendanceServices-9bf2f837.js";document.addEventListener("DOMContentLoaded",async()=>{J(),X(),V({preLogoutCallback:()=>{typeof x<"u"&&x.close&&x.close()}}),x.initialize({toastCallback:(t,e)=>{let a;e==="success"?a="linear-gradient(to right, #22c55e, #16a34a)":e==="error"?a="linear-gradient(to right, #ef4444, #dc2626)":a="linear-gradient(to right, #3b82f6, #2563eb)",Z({text:t,duration:3e3,close:!0,gravity:"top",position:"right",style:{background:a,borderRadius:"8px"}}).showToast()}});const g=document.getElementById("employeeTableBody"),w=document.getElementById("loadingMessage"),A=document.getElementById("employeeListError"),P=document.getElementById("employeeListSuccess"),I=document.getElementById("paginationInfo"),y=document.getElementById("prevPageBtn"),f=document.getElementById("nextPageBtn"),T=document.getElementById("searchInput"),o=document.getElementById("editEmployeeModal"),M=document.getElementById("closeEditEmployeeModalBtn"),D=document.getElementById("cancelEditEmployeeBtn"),h=document.getElementById("editEmployeeForm"),E=document.getElementById("editErrorMessage"),b=document.getElementById("editSuccessMessage"),S=document.getElementById("editEmployeeId"),G=document.getElementById("editName"),U=document.getElementById("editEmail"),_=document.getElementById("editPosition"),L=document.getElementById("editDepartment"),F=document.getElementById("editBaseSalary"),H=document.getElementById("editAddress"),i=document.getElementById("userAvatar");document.getElementById("userDropdown"),document.getElementById("dropdownMenu");let p=1;const j=10;let $="",z="",k=[];const d=(t,e,a="success",s=!1,r=2e3)=>{u.fire({title:t,html:e,icon:a,showConfirmButton:s,timer:r,timerProgressBar:!0,didOpen:n=>{r>0&&(n.addEventListener("mouseenter",u.stopTimer),n.addEventListener("mouseleave",u.resumeTimer))}})},K=async()=>{try{const t=await m.getCurrentUser();t&&t.photo_url&&i?i.src=t.photo_url:i&&(i.src="/assets/default-avatar.png")}catch(t){console.error("Gagal memuat profil pengguna:",t),i&&(i.src="/assets/default-avatar.png")}},N=async()=>{try{k=await Y.getAllDepartments(),L.innerHTML='<option value="">Pilih Departemen</option>',Array.isArray(k)&&k.forEach(e=>{const a=document.createElement("option");a.value=e.name,a.textContent=e.name,L.appendChild(a)})}catch(t){console.error("Gagal memuat daftar departemen untuk modal edit:",t),d("Error","Gagal memuat daftar departemen. Silakan coba lagi.","error",!0),(t.status===401||t.status===403)&&setTimeout(()=>m.logout(),2e3)}},l=async()=>{g.innerHTML="",w.classList.remove("hidden"),A.classList.add("hidden"),P.classList.add("hidden");try{const t=await B.getAllUsers(p,j,$,z);w.classList.add("hidden"),t.data&&t.data.length>0?(await R(t.data),O(t.total,t.page,t.limit)):(g.innerHTML='<tr><td colspan="8" class="text-center py-4 text-gray-500">Tidak ada data karyawan.</td></tr>',I.textContent="Menampilkan 0 dari 0 karyawan",y.disabled=!0,f.disabled=!0)}catch(t){console.error("Gagal memuat data karyawan:",t),w.classList.add("hidden");let e="Gagal memuat data karyawan. Silakan coba lagi.";t.status===401||t.status===403?(e="Sesi Anda telah berakhir atau Anda tidak memiliki izin. Silakan login kembali.",setTimeout(()=>m.logout(),2e3)):t.message&&(e=t.message),d("Error Data",e,"error",!0)}},R=async t=>{g.innerHTML="";for(const e of t){const a=document.createElement("tr");a.className="border-b border-gray-100 hover:bg-gray-50";let s="/assets/default-avatar.png";try{s=await W(e.id,e.name,48)}catch(r){console.warn(`Gagal memuat foto untuk user ${e.name}:`,r),s=`https://placehold.co/48x48/E2E8F0/4A5568?text=${e.name?e.name.charAt(0).toUpperCase():"?"}`}a.innerHTML=`
                <td class="px-4 py-3">
                    <img src="${s}" alt="${e.name}" class="h-10 w-10 rounded-full object-cover profile-thumb">
                </td>
                <td class="px-4 py-3 text-sm font-medium text-gray-900">${e.name}</td>
                <td class="px-4 py-3 text-sm text-gray-700">${e.email}</td>
                <td class="px-4 py-3 text-sm text-gray-700 capitalize">${e.role}</td>
                <td class="px-4 py-3 text-sm text-gray-700">${e.position||"-"}</td>
                <td class="px-4 py-3 text-sm text-gray-700">${e.department||"-"}</td>
                <td class="px-4 py-3 text-sm text-gray-700">Rp ${e.base_salary?e.base_salary.toLocaleString("id-ID"):"0"}</td>
                <td class="px-4 py-3 text-sm flex items-center space-x-2">
                    <button class="edit-btn text-blue-600 hover:text-blue-800 transition-colors duration-200 p-1 rounded-md hover:bg-blue-50" title="Edit" data-id="${e.id}">
                        <i data-feather="edit" class="w-5 h-5"></i>
                    </button>
                    <button class="delete-btn text-red-600 hover:text-red-800 transition-colors duration-200 p-1 rounded-md hover:bg-red-50" title="Hapus" data-id="${e.id}" data-name="${e.name}">
                        <i data-feather="trash-2" class="w-5 h-5"></i>
                    </button>
                </td>
            `,g.appendChild(a)}feather.replace(),document.querySelectorAll(".edit-btn").forEach(e=>{e.addEventListener("click",a=>q(a.currentTarget.dataset.id))}),document.querySelectorAll(".delete-btn").forEach(e=>{e.addEventListener("click",a=>Q(a.currentTarget.dataset.id,a.currentTarget.dataset.name))})},O=(t,e,a)=>{const s=Math.ceil(t/a),r=(e-1)*a+1,n=Math.min(e*a,t);I.textContent=`Menampilkan ${r}-${n} dari ${t} karyawan`,y.disabled=e===1,f.disabled=e>=s},q=async t=>{E.classList.add("hidden"),b.classList.add("hidden"),E.textContent="",b.textContent="",k.length===0&&await N();try{const e=await B.getUserByID(t);e?(S.value=e.id,G.value=e.name,U.value=e.email,_.value=e.position||"",L.value=e.department||"",F.value=e.base_salary||0,H.value=e.address||"",o.classList.remove("hidden"),setTimeout(()=>o.classList.add("active"),10)):d("Data Tidak Ditemukan","Data karyawan tidak ditemukan.","error")}catch(e){console.error("Gagal mengambil data karyawan untuk edit:",e),d("Gagal Memuat Data",`Gagal memuat data edit: ${e.message||"Terjadi kesalahan"}`,"error",!0),(e.status===401||e.status===403)&&setTimeout(()=>m.logout(),2e3)}},v=()=>{o.classList.remove("active"),setTimeout(()=>{o.classList.add("hidden"),h.reset()},300)};M&&M.addEventListener("click",v),D&&D.addEventListener("click",v),o&&o.addEventListener("click",t=>{t.target===o&&v()}),h&&h.addEventListener("submit",async t=>{t.preventDefault(),E.classList.add("hidden"),b.classList.add("hidden");const e=S.value,a=new FormData(h),s={};for(const[n,c]of a.entries())s[n]=c;if(delete s.id,s.base_salary=parseFloat(s.base_salary),isNaN(s.base_salary)){showModalMessage("Gaji pokok harus berupa angka yang valid.","error",E,b);return}const r={name:s.name,email:s.email,position:s.position,department:s.department,base_salary:s.base_salary,address:s.address};try{const n=await B.updateUser(e,r);console.log("Karyawan berhasil diupdate:",n),d("Berhasil!","Karyawan berhasil diupdate!","success",!1,1500),setTimeout(()=>{v(),l()},1500)}catch(n){console.error("Gagal mengupdate karyawan:",n);let c="Terjadi kesalahan saat mengupdate karyawan. Silakan coba lagi.";n.details?Array.isArray(n.details)?c=n.details.map(C=>`${C.Field||"Error"}: ${C.Msg}`).join("<br>"):typeof n.details=="string"&&(c=n.details):n.message&&(c=n.message),d("Gagal Update",c,"error",!0),(n.status===401||n.status===403)&&setTimeout(()=>m.logout(),2e3)}});const Q=async(t,e)=>{u.fire({title:`Hapus ${e}?`,text:"Tindakan ini tidak dapat dibatalkan! Data karyawan akan dihapus secara permanen.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Ya, hapus!",cancelButtonText:"Batal"}).then(async a=>{if(a.isConfirmed)try{const s=await B.deleteUser(t);console.log("Karyawan berhasil dihapus:",s),u.fire({title:"Terhapus!",text:`Karyawan "${e}" berhasil dihapus.`,icon:"success",timer:2e3,showConfirmButton:!1}),l()}catch(s){console.error("Gagal menghapus karyawan:",s);let r="Terjadi kesalahan saat menghapus karyawan. Silakan coba lagi.";s.status===401||s.status===403?(r="Anda tidak memiliki izin untuk menghapus karyawan ini.",setTimeout(()=>m.logout(),2e3)):s.message&&(r=s.message),u.fire({title:"Gagal",text:r,icon:"error",confirmButtonText:"OK"})}})};if(y&&y.addEventListener("click",()=>{p>1&&(p--,l())}),f&&f.addEventListener("click",()=>{p++,l()}),T){let t;T.addEventListener("input",()=>{clearTimeout(t),t=setTimeout(()=>{$=T.value,p=1,l()},500)})}K(),l()});
