import"./input-41369e4a.js";import{u as L}from"./UserServices-7521de91.js";import{d as k}from"./DepartemenServices-1b462c09.js";import{a as p}from"./AuthServices-f47c4eb9.js";import{i as B}from"./sidebarHandler-d6522c99.js";import{i as x}from"./logoutHandler-87b1a96c.js";import{Q as h}from"./qrCodeHandler-01879f51.js";import{g as D}from"./photoUtils-18d16b34.js";import{T as I}from"./toastify-3acd0462.js";/* empty css                 */import"./AttendanceServices-f61bdc29.js";let n={name:!1,email:!1,password:!1,position:!1,department:!1,salary:!1};function m(){const t=document.getElementById("submitButton");if(!t)return;const s=Object.values(n).every(i=>i);t.disabled=!s,s?(t.classList.remove("bg-gray-400","cursor-not-allowed"),t.classList.add("bg-teal-600","hover:bg-teal-700")):(t.classList.add("bg-gray-400","cursor-not-allowed"),t.classList.remove("bg-teal-600","hover:bg-teal-700"))}function A(t){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)}function C(t){return t.trim().length>=2&&/^[a-zA-Z\s]+$/.test(t.trim())}function E(){const t=document.getElementById("name"),s=document.getElementById("email"),i=document.getElementById("password"),c=document.getElementById("position"),d=document.getElementById("department"),l=document.getElementById("base_salary");t==null||t.addEventListener("input",function(){const e=document.getElementById("nameError");C(this.value)?(n.name=!0,e.classList.add("hidden")):(n.name=!1,e.textContent="Nama harus minimal 2 karakter dan hanya huruf.",e.classList.remove("hidden")),m()}),s==null||s.addEventListener("input",function(){const e=document.getElementById("emailError");A(this.value)?(n.email=!0,e.classList.add("hidden")):(n.email=!1,e.textContent="Format email tidak valid.",e.classList.remove("hidden")),m()}),i==null||i.addEventListener("input",function(){const e=document.getElementById("passwordError");this.value.length<6?(n.password=!1,e.textContent="Password minimal 8 karakter dan harus menggunakan Campuran Huruf Besar.",e.classList.remove("hidden")):(n.password=!0,e.classList.add("hidden")),m()}),c==null||c.addEventListener("input",function(){const e=document.getElementById("positionError");this.value.trim().length<2?(n.position=!1,e.textContent="Posisi wajib diisi.",e.classList.remove("hidden")):(n.position=!0,e.classList.add("hidden")),m()}),d==null||d.addEventListener("change",function(){const e=document.getElementById("departmentError");this.value?(n.department=!0,e.classList.add("hidden")):(n.department=!1,e.textContent="Departemen wajib dipilih.",e.classList.remove("hidden")),m()}),l==null||l.addEventListener("input",function(){const e=document.getElementById("salaryError"),u=parseFloat(this.value);isNaN(u)||u<1?(n.salary=!1,e.textContent="Gaji harus angka positif.",e.classList.remove("hidden")):(n.salary=!0,e.classList.add("hidden")),m()}),m()}function S(){return Object.values(n).every(t=>t)}document.addEventListener("DOMContentLoaded",async()=>{feather.replace(),B(),E(),h.initialize({toastCallback:(r,a)=>{f(r,a)}}),x({preLogoutCallback:()=>{typeof h<"u"&&h.close&&h.close()}});const t=document.getElementById("addEmployeeForm"),s=document.getElementById("department"),i=document.getElementById("cancelButton"),c=document.querySelectorAll("#logoutButton"),d=document.getElementById("password"),l=document.getElementById("togglePassword"),e=document.getElementById("userAvatar"),u=document.getElementById("userNameNav");l&&d&&l.addEventListener("click",()=>{const r=d.getAttribute("type")==="password"?"text":"password";d.setAttribute("type",r);const a=l.querySelector("i");r==="password"?a.setAttribute("data-feather","eye-off"):a.setAttribute("data-feather","eye"),feather.replace()});function f(r,a="success"){const o={success:"linear-gradient(to right, #10b981, #14b8a6)",error:"linear-gradient(to right, #ef4444, #dc2626)",warning:"linear-gradient(to right, #f97316, #ea580c)"},g=o[a]||o.error;I({text:r,duration:a==="success"?3e3:-1,close:!0,gravity:"top",position:"center",stopOnFocus:!0,style:{background:g,borderRadius:"8px",padding:"20px 24px",boxShadow:"0 5px 15px rgba(0,0,0,0.3)",maxWidth:"400px",textAlign:"center"},modal:!0}).showToast()}const b=async()=>{try{if(!localStorage.getItem("token"))return;let a=p.getCurrentUser();if(!a||a.role!=="admin")return;const o=await D(a.id,a.name,40);e&&(e.src=o,e.alt=a.name||"Admin"),u&&(u.textContent=a.name||"Admin")}catch(r){console.error("Error fetching admin profile data for header:",r)}};await(async()=>{try{const r=await k.getAllDepartments();s.innerHTML='<option value="">Pilih Departemen</option>',r.forEach(a=>{const o=document.createElement("option");o.value=a.name,o.textContent=a.name,s.appendChild(o)})}catch(r){console.error("Gagal memuat daftar departemen:",r),f("Gagal memuat daftar departemen.","error"),r.status===401&&p.logout()}})(),await b(),t.addEventListener("submit",async r=>{var v;if(r.preventDefault(),!S()){f("Harap perbaiki semua kesalahan pada form.","error");return}const a=new FormData(t),o=Object.fromEntries(a.entries());o.role="karyawan",o.base_salary=parseFloat(o.base_salary);const g=localStorage.getItem("token");if(!g){p.logout();return}try{await L.registerUser(o,g),f("Karyawan baru berhasil didaftarkan!","success"),t.reset(),E(),setTimeout(()=>{window.location.href="/src/pages/Admin/manage_employees.html"},2e3)}catch(y){console.error("Gagal mendaftarkan karyawan:",y);const w=((v=y.details)==null?void 0:v.error)||y.message||"Terjadi kesalahan server.";f(w,"error")}}),i==null||i.addEventListener("click",()=>{confirm("Anda yakin ingin membatalkan? Perubahan tidak akan disimpan.")&&(window.location.href="/src/pages/Admin/manage_employees.html")}),c.forEach(r=>{r==null||r.addEventListener("click",a=>{a.preventDefault(),p.logout()})})});
