import"./input-214ac174.js";import{u as d}from"./UserServices-9109671c.js";import{a as l}from"./AuthServices-0f733033.js";import{T as I}from"./toastify-85d374dd.js";const k=(n,a,c)=>!n||!a||!c?{isValid:!1,message:"Semua kolom password wajib diisi."}:a!==c?{isValid:!1,message:"Password baru dan konfirmasi tidak cocok."}:a.length<8?{isValid:!1,message:"Password baru minimal 8 karakter."}:/[A-Z]/.test(a)?{isValid:!0,message:"Validasi berhasil."}:{isValid:!1,message:"Password baru harus mengandung setidaknya satu huruf kapital."};document.addEventListener("DOMContentLoaded",()=>{feather.replace();const n=document.getElementById("profilePhotoPreview"),a=document.getElementById("photoUpload"),c=document.getElementById("name"),P=document.getElementById("email"),y=document.getElementById("position"),b=document.getElementById("department"),p=document.getElementById("address"),h=document.getElementById("profileForm"),u=document.getElementById("changePasswordFormProfile"),m=document.getElementById("showPasswordCheckbox"),v=document.querySelectorAll(".logout-button"),r=(t,s="success")=>{let e;s==="success"?e="linear-gradient(to right, #22c55e, #16a34a)":s==="error"?e="linear-gradient(to right, #ef4444, #dc2626)":e="linear-gradient(to right, #3b82f6, #2563eb)",I({text:t,duration:3e3,close:!0,gravity:"top",position:"right",stopOnFocus:!0,style:{background:e,borderRadius:"8px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",padding:"12px 20px"}}).showToast()},w=async()=>{try{const t=localStorage.getItem("user");if(!t)throw new Error("Sesi tidak valid. Harap login kembali.");const s=JSON.parse(t),e=await d.getUserByID(s.id);if(e){c.value=e.name||"",P.value=e.email||"",y.value=e.position||"",b.value=e.department||"",document.getElementById("base_salary").value="••••••••",p.value=e.address||"";try{const i=await d.getProfilePhoto(s.id),o=URL.createObjectURL(i);n.src=o}catch{n.src="https://via.placeholder.com/128"}}}catch(t){r(t.message,"error"),(t.message.includes("Sesi")||t.status===401||t.status===403)&&setTimeout(()=>l.logout(),2e3)}};h&&h.addEventListener("submit",async t=>{t.preventDefault();const s=localStorage.getItem("user");try{if(!s)throw new Error("Sesi tidak valid. Harap login kembali.");const e=JSON.parse(s),i=a.files[0],o={address:p.value.trim()};if(!o.address&&!i)return r("Tidak ada perubahan untuk disimpan.","error");if(o.address&&await d.updateUser(e.id,o),i){const g=await d.uploadProfilePhoto(e.id,i),E=await d.getProfilePhoto(e.id);n.src=URL.createObjectURL(E);const f=l.getCurrentUser();f&&(f.photo=g.photo_url,localStorage.setItem("user",JSON.stringify(f)))}r("Profil berhasil diupdate!","success"),w()}catch(e){r(e.message||"Gagal mengupdate profil.","error"),(e.status===401||e.status===403)&&setTimeout(()=>l.logout(),2e3)}}),u&&u.addEventListener("submit",async t=>{t.preventDefault();const s=document.getElementById("oldPasswordProfile").value,e=document.getElementById("newPasswordProfile").value,i=document.getElementById("confirmNewPasswordProfile").value,o=k(s,e,i);if(!o.isValid)return r(o.message,"error");try{await l.changePassword(s,e),r("Password berhasil diubah!","success"),u.reset()}catch(g){r(g.message||"Gagal mengubah password.","error")}}),m&&m.addEventListener("change",()=>{const t=m.checked;[document.getElementById("oldPasswordProfile"),document.getElementById("newPasswordProfile"),document.getElementById("confirmNewPasswordProfile")].forEach(e=>{e&&(e.type=t?"text":"password")})}),a&&a.addEventListener("change",function(){if(this.files&&this.files[0]){const t=new FileReader;t.onload=s=>{n.src=s.target.result},t.readAsDataURL(this.files[0])}}),v.forEach(t=>{t.addEventListener("click",s=>{s.preventDefault(),l.logout()})}),w()});
