import"./input-2b7f90d6.js";import{C as $,i as L,a as j,b as A,l as G,W as c}from"./WorkScheduleServices-6bb05019.js";import"./sidebarHandler-d6522c99.js";import"./logoutHandler-0fd76589.js";import"./AuthServices-0f733033.js";import"./sweetalert2.esm.all-9d2ad45a.js";document.addEventListener("DOMContentLoaded",()=>{const g=document.getElementById("scheduleFormModal"),T=document.getElementById("closeScheduleModalBtn"),I=document.getElementById("workScheduleForm"),k=document.getElementById("form-modal-title"),p=document.getElementById("schedule-id"),u=document.getElementById("user-id"),o=document.getElementById("schedule-date"),v=document.getElementById("start-time"),w=document.getElementById("end-time"),S=document.getElementById("note");document.getElementById("save-schedule-btn");const _=document.getElementById("cancel-schedule-btn"),y=document.getElementById("delete-schedule-btn");let n,m=null;const b=(t="create",e=null,d=null)=>{g.classList.add("active"),u.readOnly=!1,o.readOnly=!1,y.classList.add("hidden"),t==="create"?(k.textContent="Tambah Jadwal Kerja Baru",p.value="",u.value="",S.value="",d?(o.value=d.dateStr,v.value="09:00",w.value="17:00"):(o.value="",v.value="",w.value="")):t==="edit"&&e&&(k.textContent="Edit Jadwal Kerja",p.value=e.id,u.value=e.extendedProps.userId,u.readOnly=!0,o.value=e.start.toISOString().split("T")[0],o.readOnly=!0,v.value=e.start.toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),w.value=e.end?e.end.toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}):"",S.value=e.extendedProps.note||"",m=e,y.classList.remove("hidden"))},h=()=>{g.classList.remove("active"),I.reset(),m=null,feather.replace()};T.addEventListener("click",h),_.addEventListener("click",h),g.addEventListener("click",t=>{t.target===g&&h()});const f=async(t=null)=>{try{let e={};if(t)e.start_date=t.startStr.split("T")[0],e.end_date=t.endStr.split("T")[0];else if(n){const a=n.view;e.start_date=a.activeStart.toISOString().split("T")[0],e.end_date=a.activeEnd.toISOString().split("T")[0]}else{const a=new Date;e.start_date=new Date(a.getFullYear(),a.getMonth(),1).toISOString().split("T")[0],e.end_date=new Date(a.getFullYear(),a.getMonth()+1,0).toISOString().split("T")[0]}const d=document.getElementById("filter-user-id")?document.getElementById("filter-user-id").value:"";d&&(e.user_id=d);const r=(await c.getAllWorkSchedules(e)).data;n&&n.removeAllEvents();const s=r.map(a=>({id:a.id,title:`${a.start_time}-${a.end_time} (${a.user_id})`,start:`${a.date}T${a.start_time}`,end:`${a.date}T${a.end_time}`,extendedProps:{userId:a.user_id,note:a.note},backgroundColor:"#38b2ac",borderColor:"#38b2ac"}));n&&n.addEventSource(s)}catch(e){console.error("Error fetching work schedules:",e),showAlert("Gagal memuat jadwal kerja.","error")}},D=document.getElementById("calendar");n=new $(D,{plugins:[L,j,A],initialView:"dayGridMonth",locale:G,headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay"},editable:!0,selectable:!0,eventDisplay:"block",datesSet:t=>{f(t)},select:t=>{const e=t.startStr.split("T")[0],d=new Date,l=d.getFullYear(),r=(d.getMonth()+1).toString().padStart(2,"0"),s=d.getDate().toString().padStart(2,"0"),a=`${l}-${r}-${s}`;if(e<a){showAlert("Tidak bisa membuat jadwal di tanggal yang sudah lewat!","warning"),n.unselect();return}b("create",null,t),n.unselect()},eventClick:t=>{b("edit",t.event)},eventDrop:async t=>{var a,i;const e=t.event,d=e.start.toISOString().split("T")[0],l=e.start.toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),r=e.end?e.end.toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}):l,s={user_id:e.extendedProps.userId,date:d,start_time:l,end_time:r,note:e.extendedProps.note||""};try{await c.updateWorkSchedule(e.id,s),showAlert("Jadwal berhasil diperbarui!","success")}catch(E){console.error("Error updating work schedule via drag-and-drop:",E),showAlert("Gagal memperbarui jadwal: "+(((i=(a=E.response)==null?void 0:a.data)==null?void 0:i.error)||E.message),"error"),t.revert()}},eventResize:async t=>{var s,a;const e=t.event,d=e.start.toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),l=e.end?e.end.toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}):d,r={user_id:e.extendedProps.userId,date:e.start.toISOString().split("T")[0],start_time:d,end_time:l,note:e.extendedProps.note||""};try{await c.updateWorkSchedule(e.id,r),showAlert("Durasi jadwal berhasil diperbarui!","success")}catch(i){console.error("Error updating work schedule via resize:",i),showAlert("Gagal memperbarui durasi jadwal: "+(((a=(s=i.response)==null?void 0:s.data)==null?void 0:a.error)||i.message),"error"),t.revert()}}}),n.render(),I.addEventListener("submit",async t=>{var d,l;t.preventDefault();const e={user_id:u.value,date:o.value,start_time:v.value,end_time:w.value,note:S.value};try{if(p.value)await c.updateWorkSchedule(p.value,e),showAlert("Jadwal kerja berhasil diperbarui!","success");else{const r=await c.createWorkSchedule(e);showAlert("Jadwal kerja berhasil ditambahkan!","success"),n.addEvent({id:r.data.id,title:`${r.data.start_time}-${r.data.end_time} (${r.data.user_id})`,start:`${r.data.date}T${r.data.start_time}`,end:`${r.data.date}T${r.data.end_time}`,extendedProps:{userId:r.data.user_id,note:r.data.note},backgroundColor:"#38b2ac",borderColor:"#38b2ac"})}h()}catch(r){console.error("Error saving work schedule:",r),showAlert("Gagal menyimpan jadwal kerja. "+(((l=(d=r.response)==null?void 0:d.data)==null?void 0:l.error)||r.message),"error")}}),y.addEventListener("click",async()=>{var t,e;if(m&&confirm("Apakah Anda yakin ingin menghapus jadwal ini?"))try{await c.deleteWorkSchedule(m.id),m.remove(),showAlert("Jadwal kerja berhasil dihapus!","success"),h()}catch(d){console.error("Error deleting work schedule:",d),showAlert("Gagal menghapus jadwal kerja. "+(((e=(t=d.response)==null?void 0:t.data)==null?void 0:e.error)||d.message),"error")}}),document.getElementById("filter-user-id");const B=document.getElementById("apply-filter");B&&B.addEventListener("click",()=>{n.refetchEvents()})});
