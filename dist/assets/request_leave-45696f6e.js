import"./input-87732271.js";import{a as f}from"./AuthServices-0f733033.js";import{L as B}from"./LeaveRequestsServices-57462767.js";import{T as J}from"./toastify-3acd0462.js";/* empty css                 */import{i as K}from"./logoutHandler-a2e70173.js";import{g as Q}from"./photoUtils-c92e179b.js";import"./UserServices-9109671c.js";document.addEventListener("DOMContentLoaded",async()=>{feather.replace();const D=document.getElementById("userAvatar"),P=document.getElementById("dropdownMenu"),M=document.getElementById("userDropdown"),H=document.getElementById("sidebarToggle"),p=document.getElementById("mobileSidebar"),S=document.getElementById("mobileSidebarPanel"),q=document.getElementById("closeSidebar"),U=document.getElementById("leaveRequestForm"),h=document.getElementById("requestType"),i=document.getElementById("startDate"),L=document.getElementById("endDate"),F=document.getElementById("endDateField"),z=document.getElementById("reason"),C=document.getElementById("attachmentSection"),v=document.getElementById("attachment"),t=document.getElementById("formMessage"),b=document.getElementById("leaveHistoryTableBody"),w=document.getElementById("leaveHistoryMessage"),E=document.getElementById("paginationControls"),T=document.getElementById("prevPageBtn"),A=document.getElementById("nextPageBtn"),Y=document.getElementById("currentPageInfo"),y=document.getElementById("leaveLimitSummary");let c=1;const g=5;let d=[];const o=(e,a="success")=>{let n;a==="success"?n="linear-gradient(to right, #22c55e, #16a34a)":a==="error"?n="linear-gradient(to right, #ef4444, #dc2626)":n="linear-gradient(to right, #3b82f6, #2563eb)",J({text:e,duration:3e3,close:!0,gravity:"top",position:"right",stopOnFocus:!0,style:{background:n,borderRadius:"8px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",padding:"12px 20px"}}).showToast()},O=async()=>{try{const e=f.getCurrentUser();if(!e||!e.id)return null;const a=await Q(e.id,e.name||"");return D&&(D.src=a,D.alt=e.name||"User Avatar"),e}catch(e){return console.error("Error fetching employee profile data for header:",e),e.status===401||e.status===403?(o("Sesi tidak valid. Mengarahkan ke halaman login...","error"),f.logout()):o(e.message||"Gagal memuat data profil header.","error"),null}},R=async()=>{b.innerHTML=`
            <tr>
                <td colspan="6" class="px-6 py-4 whitespace-nowrap text-center text-gray-500">Memuat riwayat pengajuan...</td>
            </tr>
        `,w.classList.add("hidden"),E.classList.add("hidden");try{const e=f.getCurrentUser();if(!e||e.role!=="karyawan"){o("Akses ditolak. Anda tidak memiliki izin untuk melihat halaman ini.","error"),f.logout();return}let a=await B.getMyLeaveRequests();Array.isArray(a)||(console.warn("Peringatan: API /leave-requests/my-requests tidak mengembalikan array. Menerima:",a),a=[],o("Peringatan: Format data riwayat pengajuan tidak valid dari server.","info")),d=a,d.sort((n,r)=>new Date(r.created_at)-new Date(n.created_at)),d.length===0?(b.innerHTML=`
                    <tr>
                        <td colspan="6" class="px-6 py-4 whitespace-nowrap text-center text-gray-500">Tidak ada riwayat pengajuan cuti/izin.</td>
                    </tr>
                `,w.textContent="Anda belum memiliki riwayat pengajuan cuti atau sakit.",w.classList.remove("hidden"),w.classList.add("info")):(j(d,c,g),_(d.length,c,g),d.length>g&&E.classList.remove("hidden")),await G()}catch(e){console.error("Error loading leave history:",e),b.innerHTML=`
                <tr>
                    <td colspan="6" class="px-6 py-4 whitespace-nowrap text-center text-red-500">Gagal memuat riwayat pengajuan: ${e.message}</td>
                </tr>
            `,o(e.message||"Gagal memuat riwayat pengajuan.","error"),(e.status===401||e.status===403)&&f.logout()}},G=async()=>{if(y){y.innerHTML='<p class="text-gray-500">Memuat informasi batasan cuti...</p>',y.classList.remove("hidden");try{const e=await B.getLeaveSummary(),a=new Date().getFullYear();let n=`Anda sudah mengajukan <span class="font-bold">${e.annual_leave_count}</span> kali cuti di tahun ${a}. (Batas: 12 kali)`,r="text-gray-700";e.annual_leave_count>=12?(n=`<span class="font-bold text-red-600">Anda telah mencapai batas maksimal 12 kali pengajuan cuti untuk tahun ${a}.</span>`,r="text-red-600"):e.annual_leave_count>=10&&(r="text-orange-500"),y.innerHTML=`
                <p class="${r}">ðŸ“… ${n}</p>
                <p class="text-sm text-gray-500 mt-2">Catatan: Pengajuan cuti dapat dilakukan berkali-kali dalam sebulan selama kuota tahunan masih ada.</p>
            `,y.classList.remove("hidden")}catch(e){console.error("Error updating leave limit summary:",e),y.innerHTML='<p class="text-red-500">Gagal memuat informasi batasan cuti.</p>',y.classList.remove("hidden"),(e.status===401||e.status===403)&&(o("Sesi tidak valid. Mengarahkan ke halaman login...","error"),f.logout())}}},j=(e,a,n)=>{b.innerHTML="";const r=(a-1)*n,$=r+n;e.slice(r,$).forEach(s=>{const l=b.insertRow();let m=new Date(s.start_date+"T00:00:00").toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric"});if(s.start_date!==s.end_date){const N=new Date(s.end_date+"T00:00:00").toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric"});m=`${m} - ${N}`}let x="",I=s.status;switch(s.status){case"pending":x="text-yellow-600",I="Menunggu";break;case"approved":x="text-green-600",I="Disetujui";break;case"rejected":x="text-red-600",I="Ditolak";break;default:x="text-gray-600";break}l.innerHTML=`
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${m}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">${s.request_type||"-"}</td>
                <td class="px-6 py-4 text-sm text-gray-700 max-w-xs overflow-hidden text-ellipsis">${s.reason||"-"}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm ${x} font-semibold">${I}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                    ${s.attachment_url?`<a href="${s.attachment_url}" target="_blank" class="text-teal-600 hover:underline">Lihat Lampiran</a>`:"-"}
                </td>
            `})},_=(e,a,n)=>{const r=Math.ceil(e/n);Y.textContent=`Halaman ${a} dari ${r}`,T.disabled=a===1,A.disabled=a===r||r===0,e>n?E.classList.remove("hidden"):E.classList.add("hidden")};T&&T.addEventListener("click",()=>{c>1&&(c--,j(d,c,g),_(d.length,c,g))}),A&&A.addEventListener("click",()=>{const e=Math.ceil(d.length/g);c<e&&(c++,j(d,c,g),_(d.length,c,g))}),h.addEventListener("change",()=>{G(),h.value==="Sakit"?(C.classList.remove("hidden"),v.setAttribute("required","required")):(C.classList.add("hidden"),v.removeAttribute("required"),v.value=""),h.value==="Cuti"?(F.classList.add("hidden"),L.removeAttribute("required"),L.value=i.value,i.setAttribute("max",i.value),i.setAttribute("min",i.value)):(F.classList.remove("hidden"),L.setAttribute("required","required"),i.removeAttribute("max"),i.removeAttribute("min"))}),i.addEventListener("change",()=>{h.value==="Cuti"&&(L.value=i.value,i.setAttribute("max",i.value),i.setAttribute("min",i.value))});let u=!1;if(U.addEventListener("submit",async e=>{if(e.preventDefault(),u)return;u=!0,t.classList.add("hidden"),t.textContent="";const a=h.value,n=i.value,r=L.value,$=z.value,k=v.files[0];if(new Date(n)>new Date(r)){o("Tanggal selesai tidak boleh sebelum tanggal mulai.","error"),t.textContent="Tanggal selesai tidak boleh sebelum tanggal mulai.",t.classList.remove("hidden"),t.classList.add("error"),u=!1;return}if(a==="Cuti"){if(n!==r){o("Untuk pengajuan 'Cuti', tanggal mulai dan tanggal selesai harus sama.","error"),t.textContent="Untuk pengajuan 'Cuti', tanggal mulai dan tanggal selesai harus sama.",t.classList.remove("hidden"),t.classList.add("error"),u=!1;return}try{const l=await B.getLeaveSummary(),m=new Date().getFullYear();if(l.annual_leave_count>=12){o(`Anda telah mencapai batas maksimal 12 kali pengajuan Cuti untuk tahun ${m}.`,"error"),t.textContent=`Anda telah mencapai batas maksimal 12 kali pengajuan Cuti untuk tahun ${m}.`,t.classList.remove("hidden"),t.classList.add("error"),u=!1;return}}catch(l){console.error("Error saat memeriksa batasan cuti di frontend:",l),o("Gagal memeriksa batasan cuti. Silakan coba lagi.","error"),t.textContent="Gagal memeriksa batasan cuti. Silakan coba lagi.",t.classList.remove("hidden"),t.classList.add("error"),u=!1;return}}if(k){if(k.size>2*1024*1024){o("Ukuran file terlalu besar! Maksimal 2MB.","error"),t.textContent="Ukuran file terlalu besar! Maksimal 2MB.",t.classList.remove("hidden"),t.classList.add("error"),u=!1;return}}else if(a==="Sakit"&&v.hasAttribute("required")){o("Lampiran (surat dokter) wajib untuk pengajuan Sakit.","error"),t.textContent="Lampiran (surat dokter) wajib untuk pengajuan Sakit.",t.classList.remove("hidden"),t.classList.add("error"),u=!1;return}const s=new FormData;s.append("request_type",a),s.append("start_date",n),s.append("end_date",r),s.append("reason",$),k&&s.append("attachment",k);try{const l=await B.createLeaveRequest(s);o(l.message||"Pengajuan berhasil dikirim!","success"),t.textContent="Pengajuan berhasil dikirim dan menunggu persetujuan admin.",t.classList.remove("hidden","error"),t.classList.add("success"),U.reset(),C.classList.add("hidden"),v.removeAttribute("required"),v.value="",h.dispatchEvent(new Event("change")),await R()}catch(l){console.error("Error submitting leave request:",l);const m=l.message||"Gagal mengirim pengajuan. Silakan coba lagi.";o(m,"error"),t.textContent=m,t.classList.remove("hidden","success"),t.classList.add("error"),(l.status===401||l.status===403)&&f.logout()}finally{u=!1}}),M&&(M.addEventListener("click",()=>{P.classList.toggle("active")}),document.addEventListener("click",e=>{M.contains(e.target)||P.classList.remove("active")})),K({}),H&&p&&S&&q){const e=()=>{p.classList.remove("hidden"),setTimeout(()=>{p.classList.add("opacity-100"),S.classList.remove("-translate-x-full")},10)},a=()=>{p.classList.remove("opacity-100"),S.classList.add("-translate-x-full"),setTimeout(()=>p.classList.add("hidden"),300)};H.addEventListener("click",e),q.addEventListener("click",a),p.addEventListener("click",n=>{n.target===p&&a()})}O(),await R(),h.dispatchEvent(new Event("change"))});
